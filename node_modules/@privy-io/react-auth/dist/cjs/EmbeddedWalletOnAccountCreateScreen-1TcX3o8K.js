"use strict";var e=require("react/jsx-runtime"),r=require("lucide-react"),t=require("react"),a=require("./context-B8VkgLLk.js"),i=require("./index-B-V647xG.js"),l=require("./internal-context-NWsAL807.js"),s=require("./use-create-wallet-without-fallback-B3AnOM0l.js"),o=require("./get-is-unified-wallet--p0rdEtP.js"),u=require("./ScreenLayout-DND5buhY.js");require("@privy-io/js-sdk-core"),require("tinycolor2"),require("uuid"),require("jose"),require("eventemitter3"),require("./useActiveWallet-Wp8zv7qb.js"),require("zustand"),require("styled-components"),require("react-device-detect"),require("./prepareFundingModalData-BADfvap9.js"),require("./events-context-Di6--rDg.js"),require("viem"),require("viem/utils"),require("./getPublicClient-CGlodIp_.js"),require("./useWallets-DEyFRWD0.js"),require("@coinbase/wallet-sdk"),require("@privy-io/ethereum"),require("mipd"),require("@privy-io/popup"),require("./paths-DizMb-lU.js"),require("./usePrivy-BM1sYNel.js"),require("@scure/base"),require("@headlessui/react"),require("@walletconnect/ethereum-provider"),require("@privy-io/urls"),require("ofetch"),require("js-cookie"),require("./frame-B14fp9oC.js"),require("@privy-io/routes"),require("x402/client"),require("@privy-io/api-base"),require("viem/accounts"),require("./use-sign-with-user-signer-BcAsQTGF.js"),require("./getEmbeddedConnectedWallet-6TsVZJkD.js"),require("./ModalHeader-HFJct04e.js"),require("@heroicons/react/24/outline/ArrowLeftIcon"),require("@heroicons/react/24/outline/ArrowRightIcon"),require("@heroicons/react/24/outline/QuestionMarkCircleIcon"),require("@heroicons/react/24/outline/XMarkIcon"),require("./Screen-M6XQZTd0.js"),require("./index-ByFhjjzH.js");const n=({errorMessage:t,onClose:a})=>t?/*#__PURE__*/e.jsx(u.ScreenLayout,{title:"Something went wrong",subtitle:t,icon:r.XCircle,iconVariant:"error",primaryCta:{label:"Close",onClick:a},watermark:!0}):/*#__PURE__*/e.jsx(u.ScreenLayout,{title:"Creating your wallet",subtitle:"Please wait...",iconVariant:"loading",watermark:!1}),c={component:()=>{let{setModalData:r,navigate:u,data:c,onUserCloseViaDialogOrKeybindRef:d}=o.usePrivyModal(),q=a.useAppConfig(),[h,w]=t.useState(""),{embeddedWallets:y}=a.useAppConfig(),{authenticated:m,user:v}=o.usePrivyContext(),{closePrivyModal:C,walletProxy:p,client:b}=l.usePrivyInternal(),{onSuccess:g,onFailure:j,callAuthOnSuccessOnClose:S,shouldCreateEth:W,shouldCreateSol:x}=c.createWallet,f="legacy-embedded-wallets-only"===q.embeddedWallets.mode&&!0===q?.embeddedWallets.requireUserOwnedRecoveryOnCreate,[E,A]=t.useState(null),{create:O}=s.useCreateWalletWithoutFallback(),P=W??(!!v&&i.shouldCreateEmbeddedEthWallet(v,q.embeddedWallets.ethereum.createOnLogin)),k=x??(!!v&&i.shouldCreateEmbeddedSolWallet(v,q.embeddedWallets.solana.createOnLogin)),I=new i.RunEffectOnce((async()=>{let e=await b.getAccessToken();if(v&&e&&p)try{let e;if(P&&k)e=await O({chainType:"ethereum",walletIndex:0,latestUser:v}),e=await O({chainType:"solana",walletIndex:0,latestUser:e.user});else if(k)e=await O({chainType:"solana",walletIndex:0,latestUser:v});else{if(!P)return void C({shouldCallAuthOnSuccess:S});e=await O({chainType:"ethereum",walletIndex:0,latestUser:v})}A(e),u("EmbeddedWalletCreatedScreen")}catch(e){w(e.message)}}));return t.useEffect((()=>m&&v?f?(r({...c,createWallet:{...c.createWallet,shouldCreateEth:P,shouldCreateSol:k},recoverySelection:{...c?.recoverySelection,isInAccountCreateFlow:!0,shouldCreateEth:P,shouldCreateSol:k}}),u(i.toEmbeddedWalletSetRecoveryScreen({walletAction:"create",showAutomaticRecovery:!1,availableRecoveryMethods:y.userOwnedRecoveryOptions,legacySetWalletPasswordFlow:!1,isResettingPassword:!1}))):void I.execute():(u("LandingScreen"),void j(Error("User must be authenticated before creating a Privy wallet")))),[f,m]),d.current=()=>null/*#__PURE__*/,e.jsx(n,{errorMessage:h||void 0,onClose:()=>{E?(g(E),C({shouldCallAuthOnSuccess:S})):(j(new l.PrivyEmbeddedWalletError("User wallet creation failed")),C({shouldCallAuthOnSuccess:!1}))}})}};exports.EmbeddedWalletOnAccountCreateScreen=c,exports.EmbeddedWalletOnAccountCreateView=n,exports.default=c;
