{"version":3,"file":"getSignedSessionId-BhFfSHeA.esm.js","names":[],"sources":["../src/modules/mfa/consumeMfaTokenIfRequiredForAction/consumeMfaTokenIfRequiredForAction.ts","../src/utils/p256Sign/p256Sign.ts","../src/modules/sessionKeys/generateSessionSignature/generateSessionSignature.ts","../src/modules/sessionKeys/getSignedSessionId/getSignedSessionId.ts"],"sourcesContent":["import type { MFAAction } from '@dynamic-labs/sdk-api-core';\n\nimport type { DynamicClient } from '../../../client/types/DynamicClient';\nimport { consumeMfaToken } from '../consumeMfaToken';\nimport { isMfaRequiredForAction } from '../isMfaRequiredForAction';\n\ntype ConsumeMfaTokenIfRequiredForActionParams = {\n  mfaAction: MFAAction;\n};\n\nexport const consumeMfaTokenIfRequiredForAction = async (\n  { mfaAction }: ConsumeMfaTokenIfRequiredForActionParams,\n  client: DynamicClient\n): Promise<string | undefined> => {\n  const isRequiredForAction = await isMfaRequiredForAction(\n    { mfaAction },\n    client\n  );\n\n  if (!isRequiredForAction) {\n    return;\n  }\n\n  return consumeMfaToken(client);\n};\n","import { bufferToHex } from '../bufferToHex';\n\ntype P256SignParams = {\n  message: string;\n  privateKeyJwk: JsonWebKey;\n};\n\nexport const p256Sign = async ({ privateKeyJwk, message }: P256SignParams) => {\n  const privateKey = await crypto.subtle.importKey(\n    'jwk',\n    privateKeyJwk,\n    {\n      name: 'ECDSA',\n      namedCurve: 'P-256',\n    },\n    false,\n    ['sign']\n  );\n\n  const signature = await crypto.subtle.sign(\n    {\n      hash: 'SHA-256',\n      name: 'ECDSA',\n    },\n    privateKey,\n    new TextEncoder().encode(message)\n  );\n\n  return bufferToHex(signature);\n};\n","import type { DynamicClient } from '../../../client/types';\nimport { assertDefined } from '../../../utils/assertDefined';\nimport { p256Sign } from '../../../utils/p256Sign';\nimport { getSessionKeys } from '../getSessionKeys';\n\ntype GenerateSessionSignatureParams = {\n  sessionId: string;\n};\n\nexport const generateSessionSignature = async (\n  { sessionId }: GenerateSessionSignatureParams,\n  client: DynamicClient\n) => {\n  const sessionKeys = getSessionKeys(client);\n  assertDefined(sessionKeys, 'Session keys not found');\n\n  const { privateKeyJwk } = sessionKeys;\n\n  const signature = await p256Sign({\n    message: sessionId,\n    privateKeyJwk,\n  });\n\n  return { signature };\n};\n","import { getCore } from '../../../client/core/getCore';\nimport type { DynamicClient } from '../../../client/types';\nimport { assertDefined } from '../../../utils/assertDefined';\nimport { generateSessionSignature } from '../generateSessionSignature';\n\nexport const getSignedSessionId = async (client: DynamicClient) => {\n  const core = getCore(client);\n\n  const sessionId = core.state.get().user?.sessionId;\n  assertDefined(sessionId, 'Session ID is required');\n\n  const { signature } = await generateSessionSignature(\n    {\n      sessionId,\n    },\n    client\n  );\n\n  assertDefined(signature, 'Signed session ID is required');\n\n  return { signature };\n};\n"],"mappings":";;;;AAUA,MAAa,qCAAqC,OAChD,EAAE,aACF,WACgC;AAMhC,KAAI,CALwB,MAAM,uBAChC,EAAE,WAAW,EACb,OACD,CAGC;AAGF,QAAO,gBAAgB,OAAO;;;;;AChBhC,MAAa,WAAW,OAAO,EAAE,eAAe,cAA8B;CAC5E,MAAM,aAAa,MAAM,OAAO,OAAO,UACrC,OACA,eACA;EACE,MAAM;EACN,YAAY;EACb,EACD,OACA,CAAC,OAAO,CACT;AAWD,QAAO,YATW,MAAM,OAAO,OAAO,KACpC;EACE,MAAM;EACN,MAAM;EACP,EACD,YACA,IAAI,aAAa,CAAC,OAAO,QAAQ,CAClC,CAE4B;;;;;ACnB/B,MAAa,2BAA2B,OACtC,EAAE,aACF,WACG;CACH,MAAM,cAAc,eAAe,OAAO;AAC1C,eAAc,aAAa,yBAAyB;CAEpD,MAAM,EAAE,kBAAkB;AAO1B,QAAO,EAAE,WALS,MAAM,SAAS;EAC/B,SAAS;EACT;EACD,CAAC,EAEkB;;;;;AClBtB,MAAa,qBAAqB,OAAO,WAA0B;CAGjE,MAAM,YAFO,QAAQ,OAAO,CAEL,MAAM,KAAK,CAAC,MAAM;AACzC,eAAc,WAAW,yBAAyB;CAElD,MAAM,EAAE,cAAc,MAAM,yBAC1B,EACE,WACD,EACD,OACD;AAED,eAAc,WAAW,gCAAgC;AAEzD,QAAO,EAAE,WAAW"}