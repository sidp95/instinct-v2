'use client'
import { __awaiter } from '../../../../_virtual/_tslib.js';
import { createMessageSender } from '../createMessageSender/createMessageSender.js';
import { createMessageHandler } from '../createMessageHandler/createMessageHandler.js';
import { PlatformService } from '../../../services/PlatformService/PlatformService.js';
import 'tldts';

const setupPlatformService = (initialParentURL) => {
    let parentURL = new URL(initialParentURL);
    const messageHandler = createMessageHandler(initialParentURL.origin);
    const messageSender = createMessageSender(initialParentURL.origin);
    PlatformService.implementation = {
        downloadFile: (fileName, file) => __awaiter(void 0, void 0, void 0, function* () {
            const element = document.createElement('a');
            element.href = URL.createObjectURL(file);
            element.download = fileName;
            document.body.appendChild(element);
            element.click();
            document.body.removeChild(element);
            URL.revokeObjectURL(element.href);
        }),
        getDisplayOrigin: () => parentURL.origin,
        getHost: () => parentURL.host,
        getHostname: () => parentURL.hostname,
        getOrigin: () => parentURL.origin,
        getTLD: () => parentURL.hostname,
        getUrl: () => parentURL,
        isNativeMobile: false,
        openURL: (url_1, ...args_1) => __awaiter(void 0, [url_1, ...args_1], void 0, function* (url, target = 'self', features = '') {
            return messageSender('OPEN_URL', {
                features,
                target,
                url,
            });
        }),
    };
    messageHandler('UPDATE_PARENT_URL', ({ url }) => {
        parentURL = new URL(url);
    });
};

export { setupPlatformService };
