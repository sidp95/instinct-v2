'use client'
import { KERNEL_V3_3, KERNEL_V3_2, KERNEL_V3_1, KERNEL_V3_0, KERNEL_V2_4 } from '@zerodev/sdk/constants';
import { ProviderKernelVersionEnum } from '@dynamic-labs/sdk-api-core';
import { logger } from './logger.js';

const KERNEL_VERSION_MAP = {
    [ProviderKernelVersionEnum.V33]: KERNEL_V3_3,
    [ProviderKernelVersionEnum.V32]: KERNEL_V3_2,
    [ProviderKernelVersionEnum.V31]: KERNEL_V3_1,
    [ProviderKernelVersionEnum.V30]: KERNEL_V3_0,
    [ProviderKernelVersionEnum.V24]: KERNEL_V2_4,
};
const ENTRY_POINT_VERSION_MAP = {
    0.6: KERNEL_V2_4,
    0.7: KERNEL_V3_1,
    0.8: KERNEL_V3_3,
};
const getKernelVersion = (kernelVersion, entryPointAddress) => {
    // If kernel version is explicitly provided, use it
    if (kernelVersion && kernelVersion in KERNEL_VERSION_MAP) {
        return KERNEL_VERSION_MAP[kernelVersion];
    }
    // If no kernel version provided, determine based on entry point version
    const entryPointVersion = entryPointAddress.version;
    if (entryPointVersion in ENTRY_POINT_VERSION_MAP) {
        return ENTRY_POINT_VERSION_MAP[entryPointVersion];
    }
    // Fallback to latest version with warning
    logger.error('Invalid kernel version', kernelVersion);
    return KERNEL_V3_3;
};

export { getKernelVersion };
