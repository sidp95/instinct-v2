import { AuthMode, type IframeRequestMessages, type SecureStorageAdapter } from '@dynamic-labs-wallet/core';
import { type MessageTransportWithDefaultOrigin, type RequestChannel } from '@dynamic-labs/message-transport';
import { iframeMessageHandler } from '../../services/iframeMessageHandler.js';
export declare class IframeManager {
    protected chainName: string;
    protected logger: import("@dynamic-labs/logger").Logger;
    instanceId: string | null;
    iframeDomain: string | null;
    environmentId: string;
    private readonly authToken;
    private readonly authMode;
    baseApiUrl: string;
    baseMPCRelayApiUrl: string;
    protected messageTransport: MessageTransportWithDefaultOrigin | null;
    protected iframeMessageHandler: iframeMessageHandler | null;
    private static iframeLoadPromise;
    protected iframe: HTMLIFrameElement | null;
    private readonly debug;
    static iframeLoadTimeout: number;
    private static iframeLoadAttempts;
    private static readonly maxRetryAttempts;
    baseClientKeysharesRelayApiUrl: string | undefined;
    private static sharedIframe;
    private static iframeInstanceCount;
    sdkVersion: string | undefined;
    /**
     * Internal secure storage adapter for mobile TEE-backed storage.
     * When set, key shares are stored in secure storage instead of localStorage.
     * This is NOT part of the public API.
     */
    protected secureStorage?: SecureStorageAdapter;
    /**
     * Request channel for handling messages from iframe (iframe â†’ host)
     * Used for secureStorage operations
     */
    protected iframeRequestChannel?: RequestChannel<Pick<IframeRequestMessages, 'getClientKeyShare' | 'setClientKeyShare'>>;
    constructor({ environmentId, baseApiUrl, baseMPCRelayApiUrl, chainName, sdkVersion, authMode, authToken, debug, baseClientKeysharesRelayApiUrl, }: {
        environmentId: string;
        authMode: AuthMode;
        authToken?: string;
        baseApiUrl: string;
        baseMPCRelayApiUrl: string;
        chainName: string;
        sdkVersion?: string;
        debug?: boolean;
        baseClientKeysharesRelayApiUrl?: string;
    }, internalOptions?: {
        secureStorage?: SecureStorageAdapter;
    });
    initialize(): Promise<void>;
    /**
     * this is called on class construction time
     * @returns {Promise<void>} that resolves when the iframe is loaded and the message transport and iframe storage are initialized
     */
    initializeIframeCommunication(): Promise<void>;
    /**
     * initialize the iframe communication by awaiting the iframe load promise
     * and initializing the message transport and iframe storage after iframe is successfully loaded
     */
    private doInitializeIframeCommunication;
    /**
     * initialize the message transport after iframe is successfully loaded
     */
    protected initializeMessageTransport(): Promise<void>;
    /**
     * Sets up message handlers for secureStorage operations from iframe
     */
    private setupSecureStorageHandlers;
    /**
     * Handler for getClientKeyShare requests from iframe
     */
    private handleGetClientKeyShare;
    /**
     * Handler for setClientKeyShare requests from iframe
     */
    private handleSetClientKeyShare;
    /**
     * Notifies the iframe that secureStorage is available.
     * Uses optional chaining since sendSecureStorageConfig may not exist in older iframe versions.
     */
    private notifySecureStorageAvailable;
    /**
     * securely exchange the auth token with iframe securely
     */
    private initAuthToken;
    /**
     * Reset the shared iframe and iframe load promise, and iframe instance count
     */
    private resetSharedIframe;
    private loadIframe;
    private assignExistingIframe;
    private createIframeLoadPromise;
    private setupIframeEventHandlersWithRetry;
    private getIframeContext;
    private createMessageListener;
    private configureIframe;
    private setIframeSource;
    /**
     * Load an iframe for a specific container
     * @param {HTMLElement} container - The container to which the iframe will be attached
     * @returns {Promise<HTMLIFrameElement>} that resolves when the iframe is loaded
     */
    private loadIframeForContainer;
    /**
     * Initializes the iframe display for a specific container.
     *
     * @param {HTMLElement} container - The container to which the iframe will be attached.
     * @returns:
     *   iframe: HTMLIFrameElement;
     *   iframeDisplay: IframeDisplayChannelAdapter;
     *   cleanup: () => void;
     */
    initializeIframeDisplayForContainer({ container, }: {
        container: HTMLElement;
    }): Promise<{
        iframe: HTMLIFrameElement;
        iframeDisplay: iframeMessageHandler;
        cleanup: () => void;
    }>;
    cleanup(): Promise<void>;
}
//# sourceMappingURL=IframeManager.d.ts.map