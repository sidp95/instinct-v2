'use client'
import { __awaiter } from '../../../../../../_virtual/_tslib.js';
import { jsx, jsxs, Fragment } from 'react/jsx-runtime';
import { useState, useCallback } from 'react';
import { useTranslation } from 'react-i18next';
import { ErrorContainer } from '../../../../components/ErrorContainer/ErrorContainer.js';
import { IconButton } from '../../../../components/IconButton/IconButton.js';
import { ModalHeader } from '../../../../components/ModalHeader/ModalHeader.js';
import { Typography } from '../../../../components/Typography/Typography.js';
import { useViewContext } from '../../../../context/ViewContext/ViewContext.js';
import { ReactComponent as SvgChevronLeft } from '../../../../shared/assets/chevron-left.js';
import { ReactComponent as SvgQuestionMark } from '../../../../shared/assets/question-mark.js';
import '@dynamic-labs/iconic';
import { useSocialAccounts } from '../../../../utils/hooks/useSocialAccounts/useSocialAccounts.js';
import { useWalletBackup } from '../../../../utils/hooks/useWalletBackup/useWalletBackup.js';
import '../../../../utils/hooks/useWalletBackup/types.js';
import { BackupStepper } from './BackupStepper.js';

const WaasBackupCloudProviderView = () => {
    var _a;
    const { pushView, goBack } = useViewContext();
    const { t } = useTranslation();
    const { isProcessingForProvider, error: socialError } = useSocialAccounts();
    const { ensureProviderLinked, getSupportedProviders } = useWalletBackup();
    const [errorMessage, setErrorMessage] = useState(null);
    const providers = getSupportedProviders();
    const handleBackClick = useCallback(() => goBack(), [goBack]);
    const handleInfoClick = useCallback(() => {
        pushView('waas-backup-info-view');
    }, [pushView]);
    const handleProviderClick = useCallback((provider) => __awaiter(void 0, void 0, void 0, function* () {
        setErrorMessage(null);
        const config = providers.find((p) => p.id === provider);
        if (!config)
            return;
        if (config.requiresOAuth) {
            const isLinked = yield ensureProviderLinked(provider);
            if (!isLinked) {
                setErrorMessage(t('dyn_waas.backup.error'));
                return;
            }
        }
        pushView('waas-backup-progress-view', { provider });
    }), [ensureProviderLinked, pushView, providers, t]);
    const backButton = (jsx(IconButton, { type: 'button', onClick: handleBackClick, "data-testid": 'back-button', children: jsx(SvgChevronLeft, {}) }));
    const infoButton = (jsx(IconButton, { type: 'button', onClick: handleInfoClick, "data-testid": 'info-button', children: jsx(SvgQuestionMark, {}) }));
    return (jsxs(Fragment, { children: [jsx(ModalHeader, { leading: backButton, trailing: infoButton, children: jsx(Typography, { variant: 'title', color: 'primary', copykey: 'dyn_waas.backup.title', children: t('dyn_waas.backup.title') }) }), jsx("div", { className: 'waas-backup-view', children: jsxs("div", { className: 'waas-backup-view__body', children: [jsx(BackupStepper, { currentStep: 0, completedSteps: 0 }), (errorMessage || socialError) && (jsx(ErrorContainer, { variant: 'error', withIcon: false, children: (_a = socialError === null || socialError === void 0 ? void 0 : socialError.message) !== null && _a !== void 0 ? _a : errorMessage })), jsx(Typography, { variant: 'title', color: 'primary', copykey: 'dyn_waas.backup.cloud_backup_title', className: 'waas-backup-view__cloud-title', children: t('dyn_waas.backup.cloud_backup_title', '1. Cloud Backup') }), jsx(Typography, { variant: 'body_normal', color: 'secondary', copykey: 'dyn_waas.backup.cloud_backup_subtitle', className: 'waas-backup-view__cloud-subtitle', children: t('dyn_waas.backup.cloud_backup_subtitle', 'Back up your first key share to a cloud provider') }), providers.map((providerConfig) => (jsxs("button", { type: 'button', className: 'waas-backup-view__provider-button', onClick: () => handleProviderClick(providerConfig.id), disabled: providerConfig.requiresOAuth &&
                                providerConfig.oauthProvider &&
                                isProcessingForProvider(providerConfig.oauthProvider), "data-testid": `${providerConfig.id}-button`, children: [providerConfig.icon, jsx(Typography, { variant: 'body_normal', color: 'primary', children: t(`dyn_waas.backup.backup_to_${providerConfig.id}`, `Backup to ${providerConfig.name}`) })] }, providerConfig.id)))] }) })] }));
};

export { WaasBackupCloudProviderView };
