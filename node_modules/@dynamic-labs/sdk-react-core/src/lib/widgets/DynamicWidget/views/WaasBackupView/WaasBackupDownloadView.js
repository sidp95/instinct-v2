'use client'
import { jsx, jsxs, Fragment } from 'react/jsx-runtime';
import { useCallback } from 'react';
import { useTranslation } from 'react-i18next';
import { ErrorContainer } from '../../../../components/ErrorContainer/ErrorContainer.js';
import { IconButton } from '../../../../components/IconButton/IconButton.js';
import { ModalHeader } from '../../../../components/ModalHeader/ModalHeader.js';
import { Typography } from '../../../../components/Typography/Typography.js';
import { TypographyButton } from '../../../../components/TypographyButton/TypographyButton.js';
import { useViewContext } from '../../../../context/ViewContext/ViewContext.js';
import { ReactComponent as SvgCheck } from '../../../../shared/assets/check.js';
import { ReactComponent as SvgDownload } from '../../../../shared/assets/download.js';
import { ReactComponent as SvgQuestionMark } from '../../../../shared/assets/question-mark.js';
import '@dynamic-labs/iconic';
import { useDownloadKeyShares } from '../../../../utils/hooks/useWalletBackup/useWalletBackup.js';
import '../../../../utils/hooks/useWalletBackup/types.js';
import { BackupStepper } from './BackupStepper.js';

const WaasBackupDownloadView = () => {
    const { pushView } = useViewContext();
    const { t } = useTranslation();
    const handleComplete = useCallback((walletCount) => {
        pushView('waas-backup-success-view', { walletCount });
    }, [pushView]);
    const { currentIndex, hasError, isComplete, isProcessing, retry, startDownload, totalWallets, } = useDownloadKeyShares(handleComplete);
    const handleInfoClick = useCallback(() => {
        pushView('waas-backup-info-view');
    }, [pushView]);
    const infoButton = (jsx(IconButton, { type: 'button', onClick: handleInfoClick, "data-testid": 'info-button', children: jsx(SvgQuestionMark, {}) }));
    const getButtonContent = () => {
        if (isComplete) {
            return (jsxs("span", { className: 'waas-backup-view__download-button-content', children: [jsx(SvgCheck, { className: 'waas-backup-view__download-icon' }), t('dyn_waas.backup.download_complete')] }));
        }
        if (isProcessing) {
            return (jsxs("span", { className: 'waas-backup-view__download-button-content', children: [jsx(SvgDownload, { className: 'waas-backup-view__download-icon' }), t('dyn_waas.backup.downloading', {
                        current: currentIndex,
                        total: totalWallets,
                    })] }));
        }
        if (hasError) {
            return t('dyn_waas.backup.error_try_again');
        }
        return t('dyn_waas.backup.download_key_share');
    };
    return (jsxs(Fragment, { children: [jsx(ModalHeader, { trailing: infoButton, children: jsx(Typography, { variant: 'title', color: 'primary', copykey: 'dyn_waas.backup.title', children: t('dyn_waas.backup.title') }) }), jsx("div", { className: 'waas-backup-view', children: jsxs("div", { className: 'waas-backup-view__body', children: [jsx(BackupStepper, { currentStep: 1, completedSteps: 1 }), hasError && (jsx(ErrorContainer, { variant: 'error', withIcon: false, children: t('dyn_waas.backup.download_error') })), jsx(Typography, { variant: 'title', color: 'primary', copykey: 'dyn_waas.backup.download_title', className: 'waas-backup-view__cloud-title', children: t('dyn_waas.backup.download_title') }), jsx(Typography, { variant: 'body_normal', color: 'secondary', copykey: 'dyn_waas.backup.download_subtitle', className: 'waas-backup-view__cloud-subtitle', children: t('dyn_waas.backup.download_subtitle') }), jsx(TypographyButton, { dataTestId: 'download-key-share-button', onClick: hasError ? retry : startDownload, disabled: isProcessing || isComplete, buttonVariant: isProcessing || isComplete ? 'secondary' : 'brand-primary', typographyProps: {
                                color: 'inherit',
                            }, expanded: true, children: getButtonContent() })] }) })] }));
};

export { WaasBackupDownloadView };
