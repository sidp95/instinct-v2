'use client'
'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var _tslib = require('../../../../../../_virtual/_tslib.cjs');
var jsxRuntime = require('react/jsx-runtime');
var React = require('react');
var reactI18next = require('react-i18next');
var ErrorContainer = require('../../../../components/ErrorContainer/ErrorContainer.cjs');
var IconButton = require('../../../../components/IconButton/IconButton.cjs');
var ModalHeader = require('../../../../components/ModalHeader/ModalHeader.cjs');
var Typography = require('../../../../components/Typography/Typography.cjs');
var ViewContext = require('../../../../context/ViewContext/ViewContext.cjs');
var chevronLeft = require('../../../../shared/assets/chevron-left.cjs');
var questionMark = require('../../../../shared/assets/question-mark.cjs');
require('@dynamic-labs/iconic');
var useSocialAccounts = require('../../../../utils/hooks/useSocialAccounts/useSocialAccounts.cjs');
var useWalletBackup = require('../../../../utils/hooks/useWalletBackup/useWalletBackup.cjs');
require('../../../../utils/hooks/useWalletBackup/types.cjs');
var BackupStepper = require('./BackupStepper.cjs');

const WaasBackupCloudProviderView = () => {
    var _a;
    const { pushView, goBack } = ViewContext.useViewContext();
    const { t } = reactI18next.useTranslation();
    const { isProcessingForProvider, error: socialError } = useSocialAccounts.useSocialAccounts();
    const { ensureProviderLinked, getSupportedProviders } = useWalletBackup.useWalletBackup();
    const [errorMessage, setErrorMessage] = React.useState(null);
    const providers = getSupportedProviders();
    const handleBackClick = React.useCallback(() => goBack(), [goBack]);
    const handleInfoClick = React.useCallback(() => {
        pushView('waas-backup-info-view');
    }, [pushView]);
    const handleProviderClick = React.useCallback((provider) => _tslib.__awaiter(void 0, void 0, void 0, function* () {
        setErrorMessage(null);
        const config = providers.find((p) => p.id === provider);
        if (!config)
            return;
        if (config.requiresOAuth) {
            const isLinked = yield ensureProviderLinked(provider);
            if (!isLinked) {
                setErrorMessage(t('dyn_waas.backup.error'));
                return;
            }
        }
        pushView('waas-backup-progress-view', { provider });
    }), [ensureProviderLinked, pushView, providers, t]);
    const backButton = (jsxRuntime.jsx(IconButton.IconButton, { type: 'button', onClick: handleBackClick, "data-testid": 'back-button', children: jsxRuntime.jsx(chevronLeft.ReactComponent, {}) }));
    const infoButton = (jsxRuntime.jsx(IconButton.IconButton, { type: 'button', onClick: handleInfoClick, "data-testid": 'info-button', children: jsxRuntime.jsx(questionMark.ReactComponent, {}) }));
    return (jsxRuntime.jsxs(jsxRuntime.Fragment, { children: [jsxRuntime.jsx(ModalHeader.ModalHeader, { leading: backButton, trailing: infoButton, children: jsxRuntime.jsx(Typography.Typography, { variant: 'title', color: 'primary', copykey: 'dyn_waas.backup.title', children: t('dyn_waas.backup.title') }) }), jsxRuntime.jsx("div", { className: 'waas-backup-view', children: jsxRuntime.jsxs("div", { className: 'waas-backup-view__body', children: [jsxRuntime.jsx(BackupStepper.BackupStepper, { currentStep: 0, completedSteps: 0 }), (errorMessage || socialError) && (jsxRuntime.jsx(ErrorContainer.ErrorContainer, { variant: 'error', withIcon: false, children: (_a = socialError === null || socialError === void 0 ? void 0 : socialError.message) !== null && _a !== void 0 ? _a : errorMessage })), jsxRuntime.jsx(Typography.Typography, { variant: 'title', color: 'primary', copykey: 'dyn_waas.backup.cloud_backup_title', className: 'waas-backup-view__cloud-title', children: t('dyn_waas.backup.cloud_backup_title', '1. Cloud Backup') }), jsxRuntime.jsx(Typography.Typography, { variant: 'body_normal', color: 'secondary', copykey: 'dyn_waas.backup.cloud_backup_subtitle', className: 'waas-backup-view__cloud-subtitle', children: t('dyn_waas.backup.cloud_backup_subtitle', 'Back up your first key share to a cloud provider') }), providers.map((providerConfig) => (jsxRuntime.jsxs("button", { type: 'button', className: 'waas-backup-view__provider-button', onClick: () => handleProviderClick(providerConfig.id), disabled: providerConfig.requiresOAuth &&
                                providerConfig.oauthProvider &&
                                isProcessingForProvider(providerConfig.oauthProvider), "data-testid": `${providerConfig.id}-button`, children: [providerConfig.icon, jsxRuntime.jsx(Typography.Typography, { variant: 'body_normal', color: 'primary', children: t(`dyn_waas.backup.backup_to_${providerConfig.id}`, `Backup to ${providerConfig.name}`) })] }, providerConfig.id)))] }) })] }));
};

exports.WaasBackupCloudProviderView = WaasBackupCloudProviderView;
