import{d5 as E,dq as I,d9 as a,d4 as k,dr as q}from"./index-BZUZJG0z.js";import{n as M}from"./ScreenLayout-DIdy7nhJ-CtKEKsly.js";import{C as P}from"./circle-check-big-CartQiBB.js";import{C as j}from"./circle-x-DmvkV2q4.js";import"./ModalHeader-D5psNgrf-BlEKM6aB.js";import"./Screen-q8npRQhQ-DadJ2eBF.js";import"./index-Dq_xe9dz-CmgW7sSb.js";import"./createLucideIcon-B72mi0g_.js";const N=({status:r,title:u,description:c,userIntentRequired:f,retriesRemaining:s,hasSelectedCta:n,onContinue:o,onRetry:l})=>{let d=a.useMemo((()=>{switch(r){case"loading":default:return;case"success":return f?{label:n?"Continuing...":"Continue",onClick:o,disabled:n,loading:n}:void 0;case"error":return s>0?{label:"Retry",onClick:l}:void 0}}),[r,n,o,l]),i=a.useMemo((()=>({loading:"loading",ready:"subtle",disabled:"subtle",success:"success",error:"error"})[r]||"loading"),[r]);return k.jsx(M,{icon:r==="loading"||r==="ready"?void 0:r==="success"?P:j,iconVariant:i,title:u,subtitle:c,primaryCta:d,watermark:!0})},z={component:()=>{let{lastScreen:r,data:u,navigate:c,setModalData:f}=E(),{status:s,token:n,waitForResult:o,reset:l,execute:d}=I(),i=a.useRef([]),C=t=>{i.current=[t,...i.current]},[S,w]=a.useState(!0);a.useEffect((()=>(C(setTimeout(w,1e3,!1)),()=>{i.current.forEach((t=>clearTimeout(t))),i.current=[]})),[]);let[T,p]=a.useState(""),[v,y]=a.useState("Checking that you are a human..."),[R,b]=a.useState(!1),[h,x]=a.useState(3),e=u==null?void 0:u.captchaModalData,g=async t=>{try{await(e==null?void 0:e.callback(t)),e!=null&&e.onSuccessNavigateTo&&c(e==null?void 0:e.onSuccessNavigateTo,!1)}catch(m){if(m instanceof q)return;f({errorModalData:{error:m,previousScreen:r||"LandingScreen"}}),c((e==null?void 0:e.onErrorNavigateTo)||"ErrorScreen",!1)}};return a.useEffect((()=>{s==="success"?C(setTimeout((async()=>{let t=await o();!t||e!=null&&e.userIntentRequired||g(t)}),1e3)):s==="ready"&&C(setTimeout((()=>{s==="ready"&&d()}),500))}),[s]),a.useEffect((()=>{if(!S)switch(s){case"success":p("Success!"),y("CAPTCHA passed successfully."),e!=null&&e.userIntentRequired||setTimeout((()=>{b(!0),g(n)}),2e3);break;case"loading":p(""),y("Checking that you are a human...");break;case"error":p("Something went wrong"),y(h<=0?"If you use an adblocker or VPN, try disabling and re-attempting.":"You did not pass CAPTCHA. Please try again.")}}),[s,S,R]),k.jsx(N,{status:s,title:T,description:v,userIntentRequired:e==null?void 0:e.userIntentRequired,retriesRemaining:h,hasSelectedCta:R,onContinue:()=>{b(!0),g(n)},onRetry:async()=>{if(h<=0)return;x((m=>m-1)),l(),d();let t=await o();!t||e!=null&&e.userIntentRequired||g(t)}})}};export{z as CaptchaScreen,N as CaptchaScreenView,z as default};
