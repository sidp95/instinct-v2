import{d5 as I,d6 as M,d9 as a,dA as T,d7 as W,d4 as L,dL as R,dW as v}from"./index-BZUZJG0z.js";import{t as j}from"./use-create-wallet-without-fallback-BLN3_KXw-CjXTjOU0.js";import{u as $,o as D}from"./SetWalletPasswordForm-B55ZeX-5-CZE1u-9d.js";import"./ExclamationTriangleIcon-CLH_TsZy.js";import"./Layouts-BlFm53ED-D8gWrHLU.js";import"./ModalHeader-D5psNgrf-BlEKM6aB.js";import"./shared-JeLSzCHD-ykGp_SFG.js";import"./Checkbox-BhNoOKjX-DF6rQPDu.js";import"./CheckCircleIcon-CpqaWuvB.js";import"./ScreenHeader-CHmc4-Lu-D968ig42.js";const q={component:()=>{let{navigate:u,data:C,onUserCloseViaDialogOrKeybindRef:P}=I(),n=M(),[g,x]=a.useState(""),[c,h]=a.useState(!1),[s,m]=a.useState(),[i,b]=a.useState(null),{create:r}=j(),{authenticated:p,user:o}=T(),{closePrivyModal:l,isNewUserThisSession:E,initializeWalletProxy:U}=W(),{onSuccess:w,onFailure:d,callAuthOnSuccessOnClose:f,shouldCreateEth:y,shouldCreateSol:S}=C.createWallet,[t,A]=a.useState(null),O=new R((async()=>{try{let e;if(y&&S)e=await r({recoveryMethod:"user-passcode",recoveryPassword:s,chainType:"ethereum",walletIndex:0,latestUser:o}),e=await r({chainType:"solana",walletIndex:0,latestUser:e.user});else if(S)e=await r({recoveryMethod:"user-passcode",recoveryPassword:s,chainType:"solana",walletIndex:0,latestUser:o});else{if(!y)throw Error("Invalid args to create wallet");e=await r({recoveryMethod:"user-passcode",recoveryPassword:s,chainType:"ethereum",walletIndex:0,latestUser:o})}A(e),E?u("EmbeddedWalletCreatedScreen"):(w(e),l({shouldCallAuthOnSuccess:f}))}catch(e){x(e.message)}}));return a.useEffect((()=>{i||U(3e4).then((e=>b(e)))}),[i]),a.useEffect((()=>{if(!p||!o)return u("LandingScreen"),void d(Error("User must be authenticated before creating a Privy wallet"))}),[p]),P.current=()=>null,L.jsx($,{config:{initiatedBy:"automatic"},appName:(n==null?void 0:n.name)||"privy",loading:!i,buttonLoading:c,buttonHideAnimations:!t&&c,isResettingPassword:!1,error:g,password:s||"",onClose:()=>{t&&t.account.recoveryMethod!=="user-passcode"?(d(new v("User created a wallet but failed to set a password for it")),l({shouldCallAuthOnSuccess:!1})):t?(w(t),l({shouldCallAuthOnSuccess:f})):(d(new v("User wallet creation failed")),l({shouldCallAuthOnSuccess:!1}))},onPasswordChange:m,onPasswordGenerate:()=>m(D()),onSubmit:async()=>(h(!0),O.execute().then((()=>new Promise((e=>setTimeout(e,250))))).finally((()=>h(!1))))})}};export{q as EmbeddedWalletPasswordCreateScreen,q as default};
