import{d4 as e,d9 as o,dA as v,d7 as y,d5 as A,dq as U,d6 as M,e4 as T,e5 as $}from"./index-BZUZJG0z.js";import{F as P}from"./EnvelopeIcon-DhnnbKCd.js";import{e as q}from"./Layouts-BlFm53ED-D8gWrHLU.js";import{V as C,m as D}from"./ModalHeader-D5psNgrf-BlEKM6aB.js";import{t as R,e as F}from"./EmailInputForm-Dgoii4vf-Cv4GPqoL.js";import{e as I}from"./ErrorMessage-D8VaAP5m-C-TFvMaa.js";import{n as L}from"./ScreenLayout-DIdy7nhJ-CtKEKsly.js";import{M as N}from"./mail-BQhl7vwX.js";import"./Screen-q8npRQhQ-DadJ2eBF.js";import"./index-Dq_xe9dz-CmgW7sSb.js";import"./createLucideIcon-B72mi0g_.js";const V=o.forwardRef(((i,d)=>{let[t,g]=o.useState(""),[s,m]=o.useState(""),[l,u]=o.useState(!1),{authenticated:S,user:a}=v(),{initUpdateEmail:p}=y(),{navigate:n,setModalData:h,currentScreen:w}=A(),{enabled:j,token:f}=U(),k=M(),E=T(t)&&(k.disablePlusEmails&&t.includes("+")?(s||m("Please enter a valid email address without a '+'."),!1):(s&&m(""),!0)),x=l||!E,c=()=>{!j||f||S?(async r=>{if(!(a!=null&&a.email))throw Error("User is required to have an email address to update it.");u(!0);try{await p({oldAddress:a.email.address,newAddress:t,captchaToken:r}),n("AwaitingPasswordlessCodeScreen")}catch(b){h({errorModalData:{error:b,previousScreen:w||"LandingScreen"}}),n("ErrorScreen")}u(!1)})(f):(h({captchaModalData:{callback:r=>{if(!(a!=null&&a.email))throw Error("User is required to have an email address to update it.");return p({oldAddress:a.email.address,newAddress:t,captchaToken:r})},userIntentRequired:!1,onSuccessNavigateTo:"AwaitingPasswordlessCodeScreen",onErrorNavigateTo:"ErrorScreen"}}),n("CaptchaScreen"))};return e.jsxs(e.Fragment,{children:[e.jsxs(W,{children:[s&&e.jsx(I,{style:{marginTop:"0.25rem",textAlign:"left"},children:s}),e.jsxs(K,{$error:!!s,children:[e.jsx($,{children:e.jsx(N,{})}),e.jsx("input",{ref:d,id:"email-input",type:"email",placeholder:"your@email.com",onChange:r=>g(r.target.value),onKeyUp:r=>{r.key==="Enter"&&c()},value:t,autoComplete:"email"}),i.stacked?null:e.jsx(C,{isSubmitting:l,onClick:c,disabled:x,children:"Submit"})]})]}),i.stacked?e.jsx(D,{loadingText:null,loading:l,disabled:x,onClick:c,style:{width:"100%"},children:"Submit"}):null]})}));let W=R,K=F;const z=({title:i="Update your email",subtitle:d="Add the email address you'd like to use going forward. We'll send you a confirmation code"})=>e.jsx(L,{title:i,subtitle:d,icon:P,watermark:!0,children:e.jsx(q,{children:e.jsx(V,{stacked:!0})})}),ae={component:()=>e.jsx(z,{})};export{ae as UpdateEmailScreen,z as UpdateEmailScreenView,ae as default};
