import{d9 as u,d7 as w,d5 as h,ea as M,eb as S,ec as x,ed as P,ee as b}from"./index-BZUZJG0z.js";import{t as g}from"./analytics-mkkvFRju-DOXuftJB.js";const p="moonpay";function q(a){return parseFloat(a)}function C(a,s=!1){let[v,A]=u.useState(null),{createAnalyticsEvent:i}=w(),{data:t,navigate:d,setModalData:c}=h(),l=t==null?void 0:t.funding,r=u.useRef(0);return u.useEffect((()=>{let o=setInterval((async()=>{var m,y;if(a)try{let[e]=await(async function(F,f){return M(`${f?S:x}/transactions/ext/${F}`,{query:{apiKey:f?P:b}})})(a,s),n=e.status==="waitingAuthorization"&&e.paymentMethod==="credit_debit_card"?"pending":e.status;if(["failed","completed","awaitingAuthorization"].includes(n)&&(i({eventName:g,payload:{status:n,provider:p,paymentMethod:e.paymentMethod,cardPaymentType:e.cardPaymentType,currency:(m=e.currency)==null?void 0:m.code,baseCurrencyAmount:e.baseCurrencyAmount,quoteCurrencyAmount:e.quoteCurrencyAmount,feeAmount:e.feeAmount,extraFeeAmount:e.extraFeeAmount,networkFeeAmount:e.networkFeeAmount,isSandbox:s}}),clearInterval(o)),n==="failed"||n==="serviceFailure")return c({funding:{...l,errorMessage:"Something went wrong adding funds from Moonpay. Please try again or use another method to fund your wallet."},solanaFundingData:t==null?void 0:t.solanaFundingData}),void d("FundingMethodSelectionScreen");A(n)}catch(e){((y=e.response)==null?void 0:y.status)!==404&&(r.current+=1),r.current>=3&&(i({eventName:g,payload:{status:"serviceFailure",provider:p}}),clearInterval(o),c({funding:{...l,errorMessage:"Something went wrong adding funds from Moonpay. Please try again or use another method to fund your wallet."},solanaFundingData:t==null?void 0:t.solanaFundingData}),d("FundingMethodSelectionScreen"))}}),3e3);return()=>clearInterval(o)}),[a,r]),v}export{q as l,C as y};
