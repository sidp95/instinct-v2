import{d6 as Q,d7 as Se,d5 as Te,dc as we,d9 as n,dd as xe,n as be,o as ye,de as Ce,df as g,dg as L,db as v,m as Ee,r as Fe,dh as Ae,d3 as y,di as $e,d4 as r}from"./index-BZUZJG0z.js";import{F as je}from"./CheckCircleIcon-D6_brTOf.js";import{c as Ne,n as Be,s as Ue}from"./Layouts-BlFm53ED-D8gWrHLU.js";import{b as V}from"./ModalHeader-D5psNgrf-BlEKM6aB.js";import{o as Pe}from"./ScreenHeader-CHmc4-Lu-D968ig42.js";import{t as X}from"./FundWalletMethodHeader-CI5afzwL-BZtXSULE.js";import{t as Le}from"./index-Dq_xe9dz-CmgW7sSb.js";import{c as ke,t as Re}from"./useGetTokenPrice-C1-pGMgN-DqVN8PHa.js";import{t as Y}from"./analytics-mkkvFRju-DOXuftJB.js";import{u as z,o as G,s as J,r as Z,d as K,f as qe}from"./reservoir-kvLjIrEo-Do6elMp6.js";import{e as He}from"./getChainName-DjpPdUSc-c2urPd0g.js";import{t as Me,n as We}from"./transaction-CnfuREWo-nROljJQP.js";import{H as Oe,X as _e}from"./BridgeNetworkSelectionView-T2-4Tr4k-dbSshkjR.js";import{I as De}from"./TransferOrBridgeLoadingScreen-BZTN__SI-D57ZmH6x.js";import{c as Qe}from"./custom-GteR2eih.js";import"./useGetSolPrice-Cfm8o9C5-DeeG65FR.js";import"./getFormattedUsdFromLamports-B6EqSEho-C-HCdwKa.js";import"./getErc20Balance-CaKjNAs9-UsIHWji5.js";import"./Value-tcJV9e0L-Dbu4EDrR.js";import"./LoadingSkeleton-U6-3yFwI-BqvAdjZO.js";import"./ErrorMessage-D8VaAP5m-C-TFvMaa.js";import"./Subtitle-CV-2yKE4-D-H5V56C.js";import"./Title-BnzYV3Is-BkAZi-Pa.js";import"./WalletIcon-hh3-YJ30.js";import"./Chip-D2-wZOHJ-DUiT6Tro.js";import"./shared-FM0rljBt-CEF3ZWm_.js";import"./ChevronDownIcon-k3TGnLFx.js";import"./formatErc20TokenAmount-BuPk9xcy-CkAr4Oc0.js";import"./ethers-TpFbevgv-CT39HWSi.js";import"./styles-CaJCyFB5-BHZKprYK.js";import"./LinkPasskeyScreen-DJveInKu-fpSMIaSF.js";import"./TodoList-CgrU7uwu-C9JMyp_T.js";import"./createLucideIcon-B72mi0g_.js";import"./check-BDT86Nu8.js";import"./ScreenLayout-DIdy7nhJ-CtKEKsly.js";import"./Screen-q8npRQhQ-DadJ2eBF.js";import"./circle-check-big-CartQiBB.js";import"./fingerprint-pattern-DCdiYDPD.js";import"./formatters-BCBPo00w.js";import"./InjectedWalletIcon-DLcYOGDj-DBB2QKeI.js";import"./Address-BGlhcEcA-BeY89XEP.js";import"./copy-PrcWgVQF.js";import"./GlobeAltIcon-COUUlDl-.js";const Lt={component:()=>{let ee=Q(),{rpcConfig:k,appId:I,closePrivyModal:te,createAnalyticsEvent:R}=Se(),{navigate:ae,setModalData:ne,data:i}=Te(),q=Q(),{wallets:ie}=we(),[C,p]=n.useState(null),[re,E]=n.useState(null),[f,se]=n.useState([]),[H,oe]=n.useState(0),[M,F]=n.useState(!1),[W,S]=n.useState(!1),[A,$]=n.useState(!1),[j,O]=n.useState(!1),[de,le]=n.useState(),[ce,_]=n.useState();if(!(i!=null&&i.funding)||i.funding.chainType!=="solana")throw Error("Invalid funding data");let{address:m,chain:T,connectedWallet:w}=i.funding,[x,ue]=n.useState(i.funding.amount),e=((w==null?void 0:w.type)==="ethereum"?w:void 0)??ie[0],N=xe((e==null?void 0:e.walletClientType)||"unknown"),D=(N==null?void 0:N.name)||"wallet",[c,me]=n.useState(null);n.useEffect((()=>{(async()=>{if(!e)return;let t=await e.getEthereumProvider();me(be({account:e.address,transport:Qe(t)}).extend(ye))})().catch(console.error)}),[e]);let[pe,fe]=n.useState(0n),he=Me(pe);n.useEffect((()=>{let t=ee.solanaRpcs[T];t?Ce({rpc:t.rpc,address:m}).then((o=>fe(BigInt(o)))).catch(console.error):console.warn("Unable to load solana rpc, skipping balance")}),[]);let[a,B]=n.useState(),{tokenPrice:ge}=ke("solana"),{fundingAmountInBaseUnit:b,fundingAmountInUsd:ve}=We({amount:x,fee:0n,tokenPrice:ge,isUsdc:i.funding.isUSDC});if(n.useEffect((()=>{(async()=>{if(!c||!e)return;let t=["solana:testnet","solana:devnet"].includes(T);t&&console.warn("Solana testnets are not supported for bridging");let o=Re(q.chains).filter((({testnet:s})=>!!s===t)),l=(await Oe({chains:o,address:e.address,appId:I,rpcConfig:k})).filter((s=>s.balance>0n));if(l.length<1)return void p(new g(`Wallet ${L(e.address)} does not have enough funds.`,void 0,v.INSUFFICIENT_BALANCE));l.sort(((s,P)=>Number(P.balance-s.balance)));let d=(await Promise.allSettled(l.map((async s=>({...s,quote:await z({isTestnet:!1,input:G({appId:I,amount:b.toString(),user:e.address,recipient:m,destinationChainId:Z,destinationCurrency:J,originChainId:s.chain.id})})}))))).filter((s=>s.status==="fulfilled")).map((s=>s.value));if(d.length<1)return void p(new g(`Unable to fetch quotes for bridging. Wallet ${L(e.address)} does not have enough funds.`,void 0,v.INSUFFICIENT_BALANCE));let U=d.map((({quote:s,balance:P,chain:Ie})=>({bridgeTx:K(s),balance:P,chain:Ie,isErc20Quote:!1}))).filter((({bridgeTx:s})=>!!s));if(U.length>1)return void se(U);let h=U.at(0);h?(S(!0),B({data:h.bridgeTx.data,to:h.bridgeTx.to,value:h.bridgeTx.value,chain:h.chain})):p(new g(`Unable to select bridge option from quotes. Wallet ${L(e.address)} does not have enough funds.`,void 0,v.INSUFFICIENT_BALANCE))})().catch(console.error)}),[c]),n.useEffect((()=>{(async()=>{let t,o;if(!c||!e||M||A||!a)return;F(!0);let l=Ee({chain:a.chain,transport:Fe(Ae(a.chain,k,I))});try{t=await l.prepareTransactionRequest({account:e.address,to:a.to,chain:a.chain,data:a.data,value:BigInt(a.value??0)})}catch(d){console.error(d),f.length>1&&E(d.shortMessage??"Something went wrong")}if(t){F(!1),$(!0);try{await c.switchChain({id:a.chain.id})}catch{await c.addChain({chain:a.chain}),await c.switchChain({id:a.chain.id})}try{o=await c.sendTransaction(t)}catch(d){console.error(d),d.name==="TransactionExecutionError"&&(f.length<1?p(new g(d.shortMessage,void 0,v.TRANSACTION_FAILURE)):E(d.shortMessage??"Something went wrong"))}if(o)return await c.waitForTransactionReceipt({hash:o}),W?(_("pending"),void le(o)):($(!1),O(!0),void R({eventName:Y,payload:{provider:"external",status:"success",txHash:o,address:e.address,chainId:a.chain.id,chainType:"ethereum",value:a.value?y(BigInt(a.value),18):void 0,token:"ETH",destination:m,destinationClusterName:"mainnet-beta",destinationChainType:"solana",destinationValue:y(b,9),destinationToken:"SOL"}}));$(!1)}else F(!1)})().catch(console.error)}),[c,a]),qe({transactionHash:de,isTestnet:!1,bridgingStatus:ce,setBridgingStatus:_,onSuccess({transactionHash:t}){S(!1),O(!0),R({eventName:Y,payload:{provider:"external",status:"success",txHash:t,address:e==null?void 0:e.address,chainId:a==null?void 0:a.chain.id,chainType:"ethereum",value:a!=null&&a.value?y(BigInt(a.value),18):void 0,token:"ETH",destination:m,destinationClusterName:"mainnet-beta",destinationChainType:"solana",destinationValue:y(b,9),destinationToken:"SOL"}})},onFailure({error:t}){S(!1),p(t)}}),n.useEffect((()=>{C&&(ne({funding:i==null?void 0:i.funding,solanaFundingData:i==null?void 0:i.solanaFundingData,sendTransaction:i==null?void 0:i.sendTransaction,errorModalData:{error:C,previousScreen:"TransferFromWalletScreen"}}),ae("ErrorScreen",!1))}),[C]),n.useEffect((()=>{if(!j)return;let t=setTimeout(te,$e);return()=>clearTimeout(t)}),[j]),j)return r.jsxs(r.Fragment,{children:[r.jsx(X,{}),r.jsx(Ne,{}),r.jsxs(Be,{children:[r.jsx(je,{color:"var(--privy-color-success)",width:"64px",height:"64px"}),r.jsx(Pe,{title:"Success!",description:`Youâ€™ve successfully added ${x} SOL to your ${q.name} wallet. It may take a minute before the funds are available to use.`})]}),r.jsx(Ue,{}),r.jsx(V,{})]});let u=f[H];return f.length>1&&u?r.jsx(_e,{displayName:D,configuredFundingChain:T,formattedBalance:he,fundingAmount:x,fundingCurrency:"SOL",fundingAmountInUsd:ve,options:f,selectedOption:u,isPreparing:M,isSubmitting:A,addressToFund:m,fundingWalletAddress:(e==null?void 0:e.address)||"",errorMessage:re,onSubmit:()=>{var t;((t=i.funding)==null?void 0:t.amount)!==x?(async function(){if(e&&u)try{let o=await z({isTestnet:!1,input:G({appId:I,amount:b.toString(),user:e.address,recipient:m,destinationChainId:Z,destinationCurrency:J,originChainId:u.chain.id})}),l=K(o);if(!l)throw Error("Invalid transaction request");S(!0),B({data:l.data,to:l.to,value:l.value,chain:u.chain})}catch(o){console.error(o),p(new g("Unable to fetch quotes for bridging",o,v.INSUFFICIENT_BALANCE))}})().catch(console.error):B({to:u.bridgeTx.to,data:u.bridgeTx.data,value:u.bridgeTx.value,chain:u.chain})},onSelect:t=>{t!==H&&(E(null),oe(t))},onAmountChange:ue}):A&&e?r.jsx(De,{walletClientType:(e==null?void 0:e.walletClientType)||"unknown",displayName:D,addressToFund:m,isBridging:W,isErc20Flow:!1,chainId:"solana",chainName:He(T),totalPriceInUsd:void 0,totalPriceInNativeCurrency:void 0,gasPriceInUsd:void 0,gasPriceInNativeCurrency:void 0}):r.jsxs(r.Fragment,{children:[r.jsx(X,{}),r.jsx(Le,{}),r.jsx("div",{style:{marginTop:"1rem"}}),r.jsx(V,{})]})}};export{Lt as AwaitingEvmToSolBridgingScreen,Lt as default};
