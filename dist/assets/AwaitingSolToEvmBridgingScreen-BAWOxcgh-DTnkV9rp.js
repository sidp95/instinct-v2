import{d6 as j,d7 as G,d5 as J,d9 as s,dk as X,df as i,dl as Z,dm as $,dd as O,dn as R,d4 as t,dp as C,db as f,di as ee}from"./index-BZUZJG0z.js";import{F as ne}from"./CheckCircleIcon-D6_brTOf.js";import{c as te,n as ae,s as re}from"./Layouts-BlFm53ED-D8gWrHLU.js";import{b as D}from"./ModalHeader-D5psNgrf-BlEKM6aB.js";import{o as se}from"./ScreenHeader-CHmc4-Lu-D968ig42.js";import{t as W}from"./FundWalletMethodHeader-CI5afzwL-BZtXSULE.js";import{t as oe}from"./index-Dq_xe9dz-CmgW7sSb.js";import{t as ie}from"./analytics-mkkvFRju-DOXuftJB.js";import{u as de,o as le,n as ce,s as ue,r as me,f as fe}from"./reservoir-kvLjIrEo-Do6elMp6.js";import{I as pe}from"./TransferOrBridgeLoadingScreen-BZTN__SI-D57ZmH6x.js";import{p as ge}from"./parseEther-CIE0GjS_.js";import"./InjectedWalletIcon-DLcYOGDj-DBB2QKeI.js";import"./WalletIcon-hh3-YJ30.js";import"./Value-tcJV9e0L-Dbu4EDrR.js";import"./LoadingSkeleton-U6-3yFwI-BqvAdjZO.js";import"./Address-BGlhcEcA-BeY89XEP.js";import"./check-BDT86Nu8.js";import"./createLucideIcon-B72mi0g_.js";import"./copy-PrcWgVQF.js";import"./GlobeAltIcon-COUUlDl-.js";import"./parseUnits-COoaZUsJ.js";const ke={component:function(){let B=j(),{closePrivyModal:k,createAnalyticsEvent:P,connectors:x}=G(),{navigate:_,setModalData:L,data:e}=J(),y=j(),E=s.useRef(!1),F=X(),[A,h]=s.useState(!1),[w,M]=s.useState(!1),[v,c]=s.useState(null),[q,H]=s.useState(),[K,N]=s.useState();if(!(e!=null&&e.funding)||e.funding.chainType!=="ethereum")throw Error("Invalid funding data");let{amount:p,connectedWallet:u,chain:o,solanaChain:Q,isUSDC:g}=e.funding,S=e.funding.address,V=e.funding.erc20Address,b=e.funding.isUSDC?"USDC":o.nativeCurrency.symbol,n=s.useMemo((()=>(u==null?void 0:u.type)==="solana"?u.provider:(function({connectors:a,connectedWalletAddress:d}){let l=a.find((r=>r.chainType==="solana"&&r.wallets.some((I=>I.address===d)))),m=l==null?void 0:l.wallet.accounts.find((r=>r.address===d));if(!l||!m)throw new i("Unable to find source wallet connector");return new Z({wallet:l.wallet,account:m})})({connectors:x,connectedWalletAddress:(u==null?void 0:u.address)||""})),[u,x]),U=s.useMemo((()=>{let a=F($);if(!a)throw new i("Unable to load solana plugin");let d=B.solanaRpcs["solana:mainnet"];if(!d)throw new i("Unable to load mainnet RPC");return a.getSolanaRpcClient({rpc:d.rpc,rpcSubscriptions:d.rpcSubscriptions,chain:"solana:mainnet",blockExplorerUrl:d.blockExplorerUrl??"https://explorer.solana.com"})}),[]),T=O(R((n==null?void 0:n.standardWallet.name)||"unknown")),Y=(T==null?void 0:T.name)||"wallet";return s.useEffect((()=>{(async function(){if(!n||!o||E.current)return;let a=F($);if(!a)return void c(new i("Unable to solana plugin"));E.current=!0,o!=null&&o.testnet&&console.warn("Solana testnets are not supported for bridging");let d=g?1e6*parseFloat(p):ge(p),l=await de({isTestnet:!!o.testnet,input:le({appId:y.id,amount:d.toString(),user:n.address,recipient:S,destinationChainId:o.id,originChainId:me,originCurrency:g?ce:ue,destinationCurrency:g?V:void 0})}).catch(console.error);if(!l)return void c(new i(`Unable to fetch quotes for bridging. Wallet ${C(n.address)} does not have enough funds.`,void 0,f.INSUFFICIENT_BALANCE));let m=await a.createTransactionFromRelayQuote({quote:l,source:n.address,solanaClient:U});if(m)try{h(!0);let r=await a.simulateTransaction({solanaClient:U,tx:m});if(r.hasError)return r.hasFunds?(console.error("Transaction failed:",r.error),void c(new i("Something went wrong",void 0,f.TRANSACTION_FAILURE))):void c(new i(`Wallet ${C(n==null?void 0:n.address)} does not have enough funds. ${l.details.currencyIn.amountFormatted} ${b} are needed to complete the transaction.`,void 0,f.INSUFFICIENT_BALANCE));let{signature:I}=await n.signAndSendTransaction({chain:"solana:mainnet",transaction:m}),z=a.getAddressFromBuffer(I);H(z),N("pending")}catch(r){if(console.error(r),/user rejected the request/gi.test(r.message||""))return void c(new i("Transaction was rejected by the user",void 0,f.TRANSACTION_FAILURE));c(new i("Something went wrong",void 0,f.TRANSACTION_FAILURE))}else c(new i(`Unable to select bridge option from quotes. Wallet ${C(n.address)} does not have enough funds.`,void 0,f.INSUFFICIENT_BALANCE))})().catch(console.error)}),[]),fe({transactionHash:q,isTestnet:!1,bridgingStatus:K,setBridgingStatus:N,onSuccess({transactionHash:a}){h(!1),M(!0),P({eventName:ie,payload:{provider:"external",status:"success",txHash:a,address:n.address,chainType:"solana",clusterName:Q,token:"SOL",destinationAddress:S,destinationChainId:o.id,destinationChainType:"ethereum",destinationValue:p,destinationToken:g?"USDC":"ETH"}})},onFailure({error:a}){h(!1),c(a)}}),s.useEffect((()=>{if(!w)return;let a=setTimeout(k,ee);return()=>clearTimeout(a)}),[w]),s.useEffect((()=>{v&&(L({funding:e==null?void 0:e.funding,solanaFundingData:e==null?void 0:e.solanaFundingData,sendTransaction:e==null?void 0:e.sendTransaction,errorModalData:{error:v,previousScreen:"TransferFromWalletScreen"}}),_("ErrorScreen",!1))}),[v]),w?t.jsxs(t.Fragment,{children:[t.jsx(W,{}),t.jsx(te,{}),t.jsxs(ae,{children:[t.jsx(ne,{color:"var(--privy-color-success)",width:"64px",height:"64px"}),t.jsx(se,{title:"Success!",description:`Youâ€™ve successfully added ${p} ${b} to your ${y.name} wallet. It may take a minute before the funds are available to use.`})]}),t.jsx(re,{}),t.jsx(D,{})]}):A&&n?t.jsx(pe,{walletClientType:R((n==null?void 0:n.standardWallet.name)||"unknown"),displayName:Y,addressToFund:S,isBridging:A,isErc20Flow:!1,chainId:o.id,chainName:o.name,totalPriceInUsd:void 0,totalPriceInNativeCurrency:void 0,gasPriceInUsd:void 0,gasPriceInNativeCurrency:void 0}):t.jsxs(t.Fragment,{children:[t.jsx(W,{}),t.jsx(oe,{}),t.jsx("div",{style:{marginTop:"1rem"}}),t.jsx(D,{})]})}};export{ke as AwaitingSolToEvmBridgingScreen,ke as default};
