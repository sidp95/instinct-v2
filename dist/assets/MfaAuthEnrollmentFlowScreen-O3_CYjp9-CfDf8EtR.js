import{dA as G,d5 as J,d6 as Q,d9 as m,d4 as e,dt as X}from"./index-BZUZJG0z.js";import{T as x,g as j,F as A,m as F}from"./ModalHeader-D5psNgrf-BlEKM6aB.js";import{F as Y}from"./ShieldCheckIcon-B-NJHB3m.js";import{t as Z,f as _,l as ee,i as te}from"./EnrollTotp-CXZmaa4A-SmrlSBba.js";import{a as oe,d as re,w,l as C,p as R,m as S}from"./PinInput-3SLvbnQa-CalC7LOu.js";import"./QrCode-Bp7vKyXB-Dl74PJZb.js";import"./FingerPrintIcon-BXA1Qwfw.js";import"./PhoneIcon-DO-kIy-O.js";import"./Chip-D2-wZOHJ-DUiT6Tro.js";import"./LoadingSkeleton-U6-3yFwI-BqvAdjZO.js";import"./ErrorScreen-DLsfgpC9-DwaPA2-1.js";import"./reservoir-kvLjIrEo-Do6elMp6.js";import"./ScreenLayout-DIdy7nhJ-CtKEKsly.js";import"./Screen-q8npRQhQ-DadJ2eBF.js";import"./index-Dq_xe9dz-CmgW7sSb.js";import"./createLucideIcon-B72mi0g_.js";import"./lock-C--KDDhh.js";import"./LinkPasskeyScreen-DJveInKu-fpSMIaSF.js";import"./TodoList-CgrU7uwu-C9JMyp_T.js";import"./check-BDT86Nu8.js";import"./circle-check-big-CartQiBB.js";import"./fingerprint-pattern-DCdiYDPD.js";import"./CopyToClipboard-BGTSFnT3-iS0t0RLm.js";import"./copy-Bx2Jwc5_-BzyfXrSH.js";import"./Layouts-BlFm53ED-D8gWrHLU.js";import"./LabelXs-oqZNqbm_-D0IQxw2J.js";import"./Subtitle-CV-2yKE4-D-H5V56C.js";import"./Title-BnzYV3Is-BkAZi-Pa.js";import"./shared-FM0rljBt-CEF3ZWm_.js";import"./dijkstra-COg3n3zL.js";const Ae={component:()=>{let{user:o,ready:B}=G(),{data:c,onUserCloseViaDialogOrKeybindRef:L}=J(),a=Q(),[v,l]=m.useState(null),[p,f]=m.useState(null),[g,k]=m.useState(null),[O,W]=m.useState(!1),[b,i]=m.useState(!1),[y,s]=m.useState(),n=async()=>{y?E(y):o?await d({user:o}):E(Error("Must be logged in to manage MFA")),setTimeout((()=>{l(null),f(null)}),500)};if(L.current=n,!(c!=null&&c.mfaEnroll))throw Error("Missing modal data for MFA enrollment screen.");let{onFailure:E,onSuccess:d,onBack:M,mfaMethods:D,verify:$,generateTotpSecret:H,enrollTotp:I,unenrollTotp:K,enrollPasskey:T}=c.mfaEnroll,N=o==null?void 0:o.mfaMethods.includes("sms"),V=o==null?void 0:o.mfaMethods.includes("totp"),q=o==null?void 0:o.mfaMethods.includes("passkey"),z=!!(o!=null&&o.phone),P=(o==null?void 0:o.linkedAccounts.filter((t=>t.type==="passkey")).map((t=>t.credentialId)))??[];function u(){l(null),f(null),s(void 0)}async function U(t=P){try{s(void 0),i(!0);let r=await T(t);return await d({user:r})}catch(r){s(r)}finally{i(!1),W(!1)}}if(!B||!o||!a)return e.jsxs(e.Fragment,{children:[e.jsx(x,{onClose:n,backFn:M},"header"),e.jsx(oe,{children:e.jsx(Z,{})}),e.jsx(re,{children:e.jsx(X,{})}),e.jsx(j,{})]});if(v==="sms")return null;if(v==="totp")return e.jsxs(e.Fragment,{children:[e.jsx(x,{backFn:u,onClose:n},"header"),e.jsx(w,{style:{marginBottom:"1.5rem"},children:e.jsx(A,{})}),e.jsx(C,{children:"Remove authenticator app verification?"}),e.jsxs(R,{children:["MFA adds an extra layer of security to your ",a==null?void 0:a.name," account. Make sure you have other methods to secure your account."]}),e.jsx(S,{children:e.jsx(F,{$warn:!0,onClick:async function(){try{s(void 0),i(!0);let t=await K();return await d({user:t})}catch(t){s(t)}finally{i(!1),l(null)}},loading:b,children:"Remove"})}),e.jsx(j,{})]});if(v==="passkey"){let t=c.mfaEnroll.shouldUnlinkOnUnenrollMfa??!0;return e.jsxs(e.Fragment,{children:[e.jsx(x,{backFn:u,onClose:n},"header"),e.jsx(w,{style:{marginBottom:"1.5rem"},children:e.jsx(A,{})}),e.jsx(C,{children:"Are you sure you want to remove this passkey?"}),e.jsx(R,{children:t?"Removing your passkey will remove as both a verification method and a login method.":"Removing your passkey will remove as a verification method."}),e.jsx(S,{children:e.jsx(F,{$warn:!0,onClick:async function(){try{s(void 0),i(!0);let r=await T([]);return await d({user:r})}catch(r){s(r)}finally{i(!1),l(null)}},loading:b,children:"Remove"})}),e.jsx(j,{})]})}return D.length!==0||N||V||q?p==="sms"?null:p==="totp"&&g?e.jsx(_,{onClose:n,onReset:u,submitEnrollmentWithTotp:t=>(async function(r){try{s(void 0),i(!0);let h=await I(r);return await d({user:h})}catch(h){s(h)}finally{i(!1),l(null)}})(t.mfaCode),error:y,totpInfo:{...g,appName:(a==null?void 0:a.name)||"Privy"}}):p==="passkey"?e.jsx(ee,{onReset:u,onClose:n,submitEnrollmentWithPasskey:U}):e.jsx(te,{showIntro:!0,userMfaMethods:o.mfaMethods,appMfaMethods:a.mfa.methods,userHasAuthSms:z,backFn:M,handleSelectMethod:async function(t){s(void 0);try{await $()}catch(r){return void s(r)}return t==="totp"?(f(t),k(null),void H().then((({totpSecret:r,totpAuthUrl:h})=>{k({authUrl:h,secret:r})})).catch((()=>{k(null),u()}))):t==="passkey"&&P.length===1?await U():void f(t)},isTotpLoading:p==="totp"&&!g,isPasskeyLoading:O,error:y,onClose:n,setRemovingMfaMethod:async function(t){s(void 0);try{await $()}catch(r){return void s(r)}l(t)}}):e.jsxs(e.Fragment,{children:[e.jsx(x,{onClose:n,backFn:M},"header"),e.jsx(w,{style:{marginBottom:"1.5rem"},children:e.jsx(Y,{})}),e.jsx(C,{children:"Add more security"}),e.jsxs(R,{children:[a==null?void 0:a.name," does not have any verification methods enabled."]}),e.jsx(S,{children:e.jsx(F,{onClick:n,children:"Close"})}),e.jsx(j,{})]})}};export{Ae as MfaAuthEnrollmentFlowScreen,Ae as default};
