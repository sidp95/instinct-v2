import{d4 as I,dA as F,d7 as V,d5 as M,d9 as m,dN as A,dO as W}from"./index-BZUZJG0z.js";import{n as U}from"./ScreenLayout-DIdy7nhJ-CtKEKsly.js";import{C as _}from"./circle-x-DmvkV2q4.js";import"./ModalHeader-D5psNgrf-BlEKM6aB.js";import"./Screen-q8npRQhQ-DadJ2eBF.js";import"./index-Dq_xe9dz-CmgW7sSb.js";import"./createLucideIcon-B72mi0g_.js";const O=({connectionFailed:i,onClose:s})=>I.jsx(U,i?{title:"Something went wrong",subtitle:"We're on it. Please try again later.",icon:_,iconVariant:"error",primaryCta:{label:"Close",onClick:s},watermark:!0}:{title:"Connecting to your wallet",subtitle:"Please wait...",iconVariant:"loading",showClose:!0,onClose:s,watermark:!1}),X={component:()=>{let{authenticated:i,user:s}=F(),{client:v,closePrivyModal:p,createAnalyticsEvent:w,walletProxy:t}=V(),{navigate:n,data:c,setModalData:E,onUserCloseViaDialogOrKeybindRef:x}=M(),P=m.useMemo((()=>Date.now()),[]),[h,S]=m.useState(!1),{onCompleteNavigateTo:a,onFailure:b,shouldForceMFA:T,entropyId:d,entropyIdVerifier:u,recoveryMethod:l,connectingWalletAddress:C,isUnifiedWallet:k=!1}=c==null?void 0:c.connectWallet,e=r=>{h||(S(!0),b(typeof r=="string"?Error(r):r))};return m.useEffect((()=>{let r;return i?t?((async()=>{let f=await v.getAccessToken();if(!f)return e("User must be authenticated and have a Privy wallet before it can be connected");try{if(!k){if(!d||!u)return e("For on-device first-class chain wallets, entropyId and entropyIdVerifier are required");await t.connect({accessToken:f,entropyId:d,entropyIdVerifier:u})}T&&await t.verifyMfa({accessToken:f});let o=(Date.now()-P)/1e3;a==="EmbeddedWalletKeyExportScreen"&&o<1?r=setTimeout((()=>{n(a,!1)}),1e3*(1-o)):n(a,!1)}catch(o){if(A(o)&&l==="privy"){let g=await v.getAccessToken();if(!g)return e("User must be authenticated and have a Privy wallet before it can be recovered");try{w({eventName:"embedded_wallet_pinless_recovery_started",payload:{walletAddress:C}});let y=await(t==null?void 0:t.recover({accessToken:g,entropyId:d,entropyIdVerifier:u}));y!=null&&y.entropyId||e(Error("Unable to recover wallet")),a?n(a):p({shouldCallAuthOnSuccess:!1}),w({eventName:"embedded_wallet_recovery_completed",payload:{walletAddress:C}}),n(a)}catch{e("An error has occurred, please try again.")}}else A(o)&&l!=="privy"&&l!=="privy-v2"?(E({...c,recoverWallet:{entropyId:d,entropyIdVerifier:u,onCompleteNavigateTo:a,onFailure:b},recoveryOAuthStatus:{provider:l,action:"recover",isInAccountCreateFlow:!1,shouldCreateEth:!1,shouldCreateSol:!1}}),n(W(l))):e(o)}})(),()=>clearTimeout(r)):void 0:e("User must be authenticated and have a Privy wallet before it can be connected")}),[i,s,t]),x.current=()=>{e("User exited before wallet could be connected"),p({shouldCallAuthOnSuccess:!1})},I.jsx(O,{connectionFailed:h,onClose:()=>p({shouldCallAuthOnSuccess:!1})})}};export{X as EmbeddedWalletConnectingScreen,O as EmbeddedWalletConnectingView,X as default};
