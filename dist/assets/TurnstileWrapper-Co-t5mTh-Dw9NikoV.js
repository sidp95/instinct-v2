import{d9 as u,d4 as $}from"./index-BZUZJG0z.js";var re=({as:a="div",...d},t)=>$.jsx(a,{...d,ref:t}),te=u.forwardRef(re),ne="https://challenges.cloudflare.com/turnstile/v0/api.js",A="cf-turnstile-script",oe="cf-turnstile",P="onloadTurnstileCallback",H=a=>!!document.getElementById(a),ie=({render:a="explicit",onLoadCallbackName:d=P,scriptOptions:{nonce:t="",defer:e=!0,async:f=!0,id:p="",appendTo:w,onError:h,crossOrigin:x=""}={}})=>{let s=p||A;if(H(s))return;let o=document.createElement("script");o.id=s,o.src=`${ne}?onload=${d}&render=${a}`,!document.querySelector(`script[src="${o.src}"]`)&&(o.defer=!!e,o.async=!!f,t&&(o.nonce=t),x&&(o.crossOrigin=x),h&&(o.onerror=h,delete window[d]),(w==="body"?document.body:document.getElementsByTagName("head")[0]).appendChild(o))},k={normal:{width:300,height:65},compact:{width:150,height:140},invisible:{width:0,height:0,overflow:"hidden"},flexible:{minWidth:300,width:"100%",height:65},interactionOnly:{width:"fit-content",height:"auto",display:"flex"}};function ae(a){if(a!=="invisible"&&a!=="interactionOnly")return a}function ce(a=A){let[d,t]=u.useState(!1);return u.useEffect(()=>{let e=()=>{H(a)&&t(!0)},f=new MutationObserver(e);return f.observe(document,{childList:!0,subtree:!0}),e(),()=>{f.disconnect()}},[a]),d}var j="unloaded",G,ue=new Promise((a,d)=>{G={resolve:a,reject:d},j==="ready"&&a(void 0)}),q=(a=P)=>(j==="unloaded"&&(j="loading",window[a]=()=>{G.resolve(),j="ready",delete window[a]}),ue),J=u.forwardRef((a,d)=>{let{scriptOptions:t,options:e={},siteKey:f,onWidgetLoad:p,onSuccess:w,onExpire:h,onError:x,onBeforeInteractive:s,onAfterInteractive:o,onUnsupported:y,onTimeout:R,onLoadScript:z,id:V,style:X,as:M="div",injectScript:D=!0,rerenderOnCallbackChange:l=!1,...Q}=a,m=e.size,K=u.useCallback(()=>typeof m>"u"?{}:e.execution==="execute"?k.invisible:e.appearance==="interaction-only"?k.interactionOnly:k[m],[e.execution,m,e.appearance]),[Y,C]=u.useState(K()),v=u.useRef(null),[g,F]=u.useState(!1),i=u.useRef(void 0),O=u.useRef(!1),W=V||oe,b=u.useRef({onSuccess:w,onError:x,onExpire:h,onBeforeInteractive:s,onAfterInteractive:o,onUnsupported:y,onTimeout:R});u.useEffect(()=>{l||(b.current={onSuccess:w,onError:x,onExpire:h,onBeforeInteractive:s,onAfterInteractive:o,onUnsupported:y,onTimeout:R})});let L=(t==null?void 0:t.id)||A,B=ce(L),N=(t==null?void 0:t.onLoadCallbackName)||P,Z=e.appearance||"always",S=u.useMemo(()=>({sitekey:f,action:e.action,cData:e.cData,theme:e.theme||"auto",language:e.language||"auto",tabindex:e.tabIndex,"response-field":e.responseField,"response-field-name":e.responseFieldName,size:ae(m),retry:e.retry||"auto","retry-interval":e.retryInterval||8e3,"refresh-expired":e.refreshExpired||"auto","refresh-timeout":e.refreshTimeout||"auto",execution:e.execution||"render",appearance:e.appearance||"always","feedback-enabled":e.feedbackEnabled||!0,callback:r=>{var n,c;O.current=!0,l?w==null||w(r):(c=(n=b.current).onSuccess)==null||c.call(n,r)},"error-callback":l?x:(...r)=>{var n,c;return(c=(n=b.current).onError)==null?void 0:c.call(n,...r)},"expired-callback":l?h:(...r)=>{var n,c;return(c=(n=b.current).onExpire)==null?void 0:c.call(n,...r)},"before-interactive-callback":l?s:(...r)=>{var n,c;return(c=(n=b.current).onBeforeInteractive)==null?void 0:c.call(n,...r)},"after-interactive-callback":l?o:(...r)=>{var n,c;return(c=(n=b.current).onAfterInteractive)==null?void 0:c.call(n,...r)},"unsupported-callback":l?y:(...r)=>{var n,c;return(c=(n=b.current).onUnsupported)==null?void 0:c.call(n,...r)},"timeout-callback":l?R:(...r)=>{var n,c;return(c=(n=b.current).onTimeout)==null?void 0:c.call(n,...r)}}),[e.action,e.appearance,e.cData,e.execution,e.language,e.refreshExpired,e.responseField,e.responseFieldName,e.retry,e.retryInterval,e.tabIndex,e.theme,e.feedbackEnabled,e.refreshTimeout,f,m,l,l?w:null,l?x:null,l?h:null,l?s:null,l?o:null,l?y:null,l?R:null]),T=u.useCallback(()=>typeof window<"u"&&!!window.turnstile,[]);return u.useEffect(function(){D&&!g&&(q(N),ie({onLoadCallbackName:N,scriptOptions:{...t,id:L}}))},[D,g,t,L,N]),u.useEffect(function(){j!=="ready"&&q(N).then(()=>F(!0)).catch(console.error)},[N]),u.useEffect(function(){if(!v.current||!g)return;let r=!1;return(async()=>{if(r||!v.current)return;let n=window.turnstile.render(v.current,S);i.current=n,i.current&&(p==null||p(i.current))})(),()=>{r=!0,i.current&&(window.turnstile.remove(i.current),O.current=!1)}},[W,g,S]),u.useImperativeHandle(d,()=>{let{turnstile:r}=window;return{getResponse(){if(!(r!=null&&r.getResponse)||!i.current||!T()){console.warn("Turnstile has not been loaded");return}return r.getResponse(i.current)},async getResponsePromise(n=3e4,c=100){return new Promise((ee,U)=>{let E,_=async()=>{if(O.current&&window.turnstile&&i.current)try{let I=window.turnstile.getResponse(i.current);return E&&clearTimeout(E),I?ee(I):U(new Error("No response received"))}catch(I){return E&&clearTimeout(E),console.warn("Failed to get response",I),U(new Error("Failed to get response"))}E||(E=setTimeout(()=>{E&&clearTimeout(E),U(new Error("Timeout"))},n)),await new Promise(I=>setTimeout(I,c)),await _()};_()})},reset(){if(!(r!=null&&r.reset)||!i.current||!T()){console.warn("Turnstile has not been loaded");return}e.execution==="execute"&&C(k.invisible);try{O.current=!1,r.reset(i.current)}catch(n){console.warn(`Failed to reset Turnstile widget ${i}`,n)}},remove(){if(!(r!=null&&r.remove)||!i.current||!T()){console.warn("Turnstile has not been loaded");return}C(k.invisible),O.current=!1,r.remove(i.current),i.current=null},render(){if(!(r!=null&&r.render)||!v.current||!T()||i.current){console.warn("Turnstile has not been loaded or container not found");return}let n=r.render(v.current,S);return i.current=n,i.current&&(p==null||p(i.current)),e.execution!=="execute"&&C(m?k[m]:{}),n},execute(){if(e.execution!=="execute"){console.warn('Execution mode is not set to "execute"');return}if(!(r!=null&&r.execute)||!v.current||!i.current||!T()){console.warn("Turnstile has not been loaded or container not found");return}r.execute(v.current,S),C(m?k[m]:{})},isExpired(){return!(r!=null&&r.isExpired)||!i.current||!T()?(console.warn("Turnstile has not been loaded"),!1):r.isExpired(i.current)}}},[i,e.execution,m,S,v,T,g,p]),u.useEffect(()=>{if(g||!B)return;if(window.turnstile){F(!0);return}let r=setInterval(()=>{window.turnstile&&(F(!0),clearInterval(r))},50);return()=>{clearInterval(r)}},[g,B]),u.useEffect(()=>{C(K())},[e.execution,m,Z]),u.useEffect(()=>{!B||typeof z!="function"||z()},[B]),$.jsx(te,{ref:v,as:M,id:W,style:{...Y,...X},...Q})});J.displayName="Turnstile";const le=({delayedExecution:a,captchaContext:d,...t})=>{let{appId:e,setError:f,setToken:p,setExecuting:w,siteKey:h,ref:x}=d;return $.jsx(J,{...t,ref:x,siteKey:h??"",options:{action:e,size:"invisible",...a?{appearance:"execute",execution:"execute"}:{appearance:"always",execution:"render"}},onUnsupported:()=>{var s;(s=t.onUnsupported)==null||s.call(t),console.warn("Browser does not support Turnstile.")},onError:s=>{var o;(o=t.onError)==null||o.call(t,s),f("Captcha failed"),w(!1)},onSuccess:s=>{var o;(o=t.onSuccess)==null||o.call(t,s),p(s),w(!1)},onExpire:s=>{var o,y;(o=t.onExpire)==null||o.call(t,s);try{(y=x.current)==null||y.reset(),f(void 0),p(void 0)}catch{f("expired_and_failed_reset")}}})};export{le as TurnstileWrapper,le as default};
