import{d4 as f,d5 as P,d6 as y,d9 as c,dA as R,d7 as M,dT as T,dU as L,dV as k,dL as F,dW as V}from"./index-BZUZJG0z.js";import{t as j}from"./use-create-wallet-without-fallback-BLN3_KXw-CjXTjOU0.js";import{n as $}from"./ScreenLayout-DIdy7nhJ-CtKEKsly.js";import{C as D}from"./circle-x-DmvkV2q4.js";import"./ModalHeader-D5psNgrf-BlEKM6aB.js";import"./Screen-q8npRQhQ-DadJ2eBF.js";import"./index-Dq_xe9dz-CmgW7sSb.js";import"./createLucideIcon-B72mi0g_.js";const q=({errorMessage:s,onClose:r})=>f.jsx($,s?{title:"Something went wrong",subtitle:s,icon:D,iconVariant:"error",primaryCta:{label:"Close",onClick:r},watermark:!0}:{title:"Creating your wallet",subtitle:"Please wait...",iconVariant:"loading",watermark:!1}),N={component:()=>{let{setModalData:s,navigate:r,data:a,onUserCloseViaDialogOrKeybindRef:p}=P(),l=y(),[S,b]=c.useState(""),{embeddedWallets:g}=y(),{authenticated:u,user:e}=R(),{closePrivyModal:i,walletProxy:v,client:O}=M(),{onSuccess:W,onFailure:m,callAuthOnSuccessOnClose:w,shouldCreateEth:x,shouldCreateSol:A}=a.createWallet,h=l.embeddedWallets.mode==="legacy-embedded-wallets-only"&&(l==null?void 0:l.embeddedWallets.requireUserOwnedRecoveryOnCreate)===!0,[C,E]=c.useState(null),{create:o}=j(),n=x??(!!e&&T(e,l.embeddedWallets.ethereum.createOnLogin)),d=A??(!!e&&L(e,l.embeddedWallets.solana.createOnLogin)),U=new F((async()=>{let I=await O.getAccessToken();if(e&&I&&v)try{let t;if(n&&d)t=await o({chainType:"ethereum",walletIndex:0,latestUser:e}),t=await o({chainType:"solana",walletIndex:0,latestUser:t.user});else if(d)t=await o({chainType:"solana",walletIndex:0,latestUser:e});else{if(!n)return void i({shouldCallAuthOnSuccess:w});t=await o({chainType:"ethereum",walletIndex:0,latestUser:e})}E(t),r("EmbeddedWalletCreatedScreen")}catch(t){b(t.message)}}));return c.useEffect((()=>u&&e?h?(s({...a,createWallet:{...a.createWallet,shouldCreateEth:n,shouldCreateSol:d},recoverySelection:{...a==null?void 0:a.recoverySelection,isInAccountCreateFlow:!0,shouldCreateEth:n,shouldCreateSol:d}}),r(k({walletAction:"create",showAutomaticRecovery:!1,availableRecoveryMethods:g.userOwnedRecoveryOptions,legacySetWalletPasswordFlow:!1,isResettingPassword:!1}))):void U.execute():(r("LandingScreen"),void m(Error("User must be authenticated before creating a Privy wallet")))),[h,u]),p.current=()=>null,f.jsx(q,{errorMessage:S||void 0,onClose:()=>{C?(W(C),i({shouldCallAuthOnSuccess:w})):(m(new V("User wallet creation failed")),i({shouldCallAuthOnSuccess:!1}))}})}};export{N as EmbeddedWalletOnAccountCreateScreen,q as EmbeddedWalletOnAccountCreateView,N as default};
