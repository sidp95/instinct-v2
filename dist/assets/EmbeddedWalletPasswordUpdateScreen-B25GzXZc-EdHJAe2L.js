import{d9 as o,dA as j,d7 as U,d5 as k,d6 as L,dX as R,dY as N,d4 as T,dZ as V,dW as y}from"./index-BZUZJG0z.js";import{u as W,o as D}from"./SetWalletPasswordForm-B55ZeX-5-CZE1u-9d.js";import"./ExclamationTriangleIcon-CLH_TsZy.js";import"./Layouts-BlFm53ED-D8gWrHLU.js";import"./ModalHeader-D5psNgrf-BlEKM6aB.js";import"./shared-JeLSzCHD-ykGp_SFG.js";import"./Checkbox-BhNoOKjX-DF6rQPDu.js";import"./CheckCircleIcon-CpqaWuvB.js";import"./ScreenHeader-CHmc4-Lu-D968ig42.js";const z={component:()=>{let[r,P]=o.useState(null),[b,v]=o.useState(!1),[l,d]=o.useState(null),[i,h]=o.useState(""),{authenticated:m,user:c}=j(),{client:S,walletProxy:f,refreshSessionAndUser:x,closePrivyModal:n,createAnalyticsEvent:t}=U(),{navigate:E,data:C,onUserCloseViaDialogOrKeybindRef:I}=k(),p=L(),{onSuccess:g,onFailure:u}=C.setWalletPassword,e=R(c),_=(r==null?void 0:r.recoveryMethod)==="user-passcode",a=(e==null?void 0:e.recoveryMethod)==="user-passcode";o.useEffect((()=>{m||(E("LandingScreen"),u(new N("User must be authenticated before setting a password on a Privy wallet")))}),[m]);let w=()=>l?(u(l),void n({shouldCallAuthOnSuccess:!1})):_?(g(r),void n({shouldCallAuthOnSuccess:!1})):(u(new y("Exited before password was added to wallet")),void n({shouldCallAuthOnSuccess:!1}));return I.current=w,T.jsx(W,{appName:(p==null?void 0:p.name)||"privy",config:{initiatedBy:"user",onCancel:w},error:l?"An error has occurred, please try again.":void 0,buttonLoading:b,buttonHideAnimations:!1,password:i,isResettingPassword:a,onPasswordGenerate:()=>h(D()),onPasswordChange:h,onSubmit:async()=>{_?(g(r),n({shouldCallAuthOnSuccess:!1})):(v(!0),d(null),await(async()=>{let M=await S.getAccessToken();if(M&&c&&(e!=null&&e.address)&&i&&f)try{t({eventName:"embedded_wallet_set_recovery_started",payload:{walletAddress:e.address,existingRecoveryMethod:e.recoveryMethod,targetRecoveryMethod:"user-passcode",isResettingPassword:a}});let{entropyId:s,entropyIdVerifier:O}=V(c);if(!(await f.setRecovery({accessToken:M,entropyId:s,entropyIdVerifier:O,recoveryPassword:i,recoveryMethod:"user-passcode"})).entropyId)return d(new y("Error setting password on privy wallet")),void t({eventName:"embedded_wallet_set_recovery_failed",payload:{walletAddress:e.address,existingRecoveryMethod:e.recoveryMethod,targetRecoveryMethod:"user-passcode",isResettingPassword:a,reason:"error setting password"}});let $=await x(),A=R($);if(!A)return d(new y("Error setting password on privy wallet")),void t({eventName:"embedded_wallet_set_recovery_failed",payload:{walletAddress:e.address,existingRecoveryMethod:e.recoveryMethod,targetRecoveryMethod:"user-passcode",isResettingPassword:a,reason:"wallet disconnected"}});P(A),t({eventName:"embedded_wallet_set_recovery_completed",payload:{walletAddress:e.address,existingRecoveryMethod:e.recoveryMethod,targetRecoveryMethod:"user-passcode",isResettingPassword:a}})}catch(s){console.warn(s),d(s instanceof Error?s:Error("Error setting password on privy wallet")),t({eventName:"embedded_wallet_set_password_failed",payload:{walletAddress:e.address,reason:s}})}})(),v(!1))},onClose:w})}};export{z as EmbeddedWalletPasswordUpdateScreen,z as default};
