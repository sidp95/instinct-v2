import{d6 as d,d9 as l,e7 as m,e8 as u,e9 as h,df as b,db as g}from"./index-BZUZJG0z.js";function w(r){return new Uint8Array(m().decode(r).messageBytes)}async function x({solanaClient:r,tx:t}){let e=u().decode(w(t)),{value:n}=await r.rpc.getFeeForMessage(e).send();return n??0n}async function E({solanaClient:r,tx:t,replaceRecentBlockhash:e}){var a;let{value:n}=await r.rpc.simulateTransaction(u().decode(t),{commitment:"confirmed",encoding:"base64",sigVerify:!1,replaceRecentBlockhash:e}).send();if(n.err==="BlockhashNotFound"&&e)throw Error("Simulation failed: Blockhash not found");return n.err==="BlockhashNotFound"?await E({solanaClient:r,tx:t,replaceRecentBlockhash:!0}):{logs:n.logs??[],error:n.err,hasError:!!n.err,hasFunds:((a=n.logs)==null?void 0:a.every((o=>!/insufficient funds/gi.test(o)&&!/insufficient lamports/gi.test(o))))??!0}}const y=(...r)=>{if(typeof Buffer>"u")throw new b("Buffer is not defined.",void 0,g.BUFFER_NOT_DEFINED);return Buffer.from(...r)};async function B({rpcSubscriptions:r,signature:t,timeout:e}){let n=new AbortController,a=await r.signatureNotifications(t,{commitment:"confirmed"}).subscribe({abortSignal:n.signal}),o=await Promise.race([new Promise((s=>{setTimeout((()=>{n.abort(),s(Error("Transaction confirmation timed out"))}),e)})),new Promise((async s=>{for await(let c of a){if(n.abort(),c.value.err)return s(Error("Transaction confirmation failed"));s(void 0)}}))]);if(o instanceof Error)throw o}function k({rpc:r,rpcSubscriptions:t,chain:e,blockExplorerUrl:n}){let a=(function({rpc:o,rpcSubscriptions:s}){return async c=>new Promise((async(f,p)=>{try{let i=await o.sendTransaction(y(c).toString("base64"),{preflightCommitment:"confirmed",encoding:"base64"}).send();await B({rpcSubscriptions:s,signature:i,timeout:1e4}),f({signature:new Uint8Array(h().encode(i))})}catch(i){p(i)}}))})({rpc:r,rpcSubscriptions:t});return{rpc:r,rpcSubscriptions:t,chain:e,blockExplorerUrl:n,sendAndConfirmTransaction:a}}function R(){let r=d(),t=l.useMemo((()=>Object.fromEntries(["solana:mainnet","solana:devnet","solana:testnet"].map((e=>[e,r.solanaRpcs[e]?k({chain:e,rpc:r.solanaRpcs[e].rpc,rpcSubscriptions:r.solanaRpcs[e].rpcSubscriptions,blockExplorerUrl:r.solanaRpcs[e].blockExplorerUrl??`https://explorer.solana.com?cluster=${e.replace("solana:","")}`}):null])))),[r.solanaRpcs]);return l.useCallback((e=>{if(!t[e])throw Error(`No RPC configuration found for chain ${e}`);return t[e]}),[t])}export{w as c,R as d,y as f,x as l,B as p,E as u};
