import{dA as A,d5 as B,d9 as a,d4 as u}from"./index-BZUZJG0z.js";import{Q as b,R as j,U as V,X as S}from"./to-ui-error-l1Vm31qE-CPb64Lxy.js";import"./PinInput-3SLvbnQa-CalC7LOu.js";import"./FingerPrintIcon-BXA1Qwfw.js";import"./PhoneIcon-DO-kIy-O.js";import"./ShieldCheckIcon-B-NJHB3m.js";import"./ModalHeader-D5psNgrf-BlEKM6aB.js";import"./ScreenLayout-DIdy7nhJ-CtKEKsly.js";import"./Screen-q8npRQhQ-DadJ2eBF.js";import"./index-Dq_xe9dz-CmgW7sSb.js";import"./ExclamationTriangleIcon-CLH_TsZy.js";import"./StackedContainer-B2vaEl56-CK5LNgwx.js";import"./useGetTokenPrice-C1-pGMgN-DqVN8PHa.js";import"./useGetSolPrice-Cfm8o9C5-DeeG65FR.js";import"./TransactionDetails-DB8AH1mq-yGptQR4G.js";import"./WalletLink-foFywOfy-BZGpYybr.js";import"./ethers-TpFbevgv-CT39HWSi.js";import"./getFormattedUsdFromLamports-B6EqSEho-C-HCdwKa.js";import"./transaction-CnfuREWo-nROljJQP.js";import"./Layouts-BlFm53ED-D8gWrHLU.js";import"./ChevronDownIcon-k3TGnLFx.js";const Z={component:()=>{let{user:t}=A(),{data:f}=B(),[s,i]=a.useState(t==null?void 0:t.mfaMethods[0]),[c,h]=a.useState(!1),[m,M]=a.useState(),[r,n]=a.useState();if(a.useEffect((()=>{i(t==null?void 0:t.mfaMethods[0])}),[t==null?void 0:t.mfaMethods]),!(f!=null&&f.mfaVerify))throw Error("Missing modal data for MFA verification screen.");let{onFailure:g,onSuccess:l,generateOptions:y,verifyTotpCode:E,verifyPasskey:v,verifySmsCode:C,sendSmsCode:x}=f.mfaVerify,k=async e=>{if(e!=="passkey")try{i(e),e==="sms"&&(i(e),await x()),e==="totp"&&i(e)}catch(o){console.error(o)}else try{i(e);let o=await y();if(!o)throw Error("something went wrong");M(o),await v(o),h(!0),n(void 0),l()}catch(o){n(S(o))}},w=async e=>{n(void 0);try{if(!e||!s)return;if(s==="passkey"){if(!m)throw Error("Missing passkey challenge");await v(m)}else s==="sms"?await C(e):s==="totp"&&await E(e);n(void 0),h(!0),l()}catch(o){throw S(o).error}},d=()=>{r||!c?g((r==null?void 0:r.error)??Error("Canceled MFA verification.")):l()},p=a.useRef(!1);return a.useEffect((()=>{!p.current&&s&&(p.current=!0,k(s).finally((()=>{p.current=!1})))}),[open]),t?s==="passkey"?u.jsx(b,{account:t.linkedAccounts.filter((e=>e.type==="passkey"&&e.enrolledInMfa)).sort(((e,o)=>o.firstVerifiedAt.valueOf()-e.firstVerifiedAt.valueOf()))[0],submitSuccess:c,hasBlockingError:(r==null?void 0:r.isBlocking)??!1,error:r==null?void 0:r.error,onClose:d,onBack:()=>{i(void 0),n(void 0)},handleSubmit:()=>w(m).catch(n)}):s==="sms"||s==="totp"?u.jsx(j,{selectedMethod:s,submitSuccess:c,hasBlockingError:(r==null?void 0:r.isBlocking)??!1,handleSubmitCode:w,onClose:d,onBack:t.mfaMethods.length>1?()=>i(void 0):void 0}):u.jsx(V,{user:t,onSelect:k,handleClose:d}):null}};export{Z as MfaAuthVerifyFlowScreen,Z as default};
