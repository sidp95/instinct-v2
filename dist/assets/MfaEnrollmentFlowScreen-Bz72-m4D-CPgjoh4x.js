import{d9 as o,dA as ae,f3 as X,d5 as V,d6 as K,d7 as le,eG as ie,d4 as e,dt as ce,f4 as me,eV as de,eW as ue,f5 as he}from"./index-BZUZJG0z.js";import{T as h,g as f,F as H,m as F,$ as fe}from"./ModalHeader-D5psNgrf-BlEKM6aB.js";import{F as D}from"./ShieldCheckIcon-B-NJHB3m.js";import{t as xe,f as je,l as pe,i as ye}from"./EnrollTotp-CXZmaa4A-SmrlSBba.js";import{F as ve}from"./CheckCircleIcon-D6_brTOf.js";import{F as J}from"./PhoneIcon-DO-kIy-O.js";import{w as we,p as ge}from"./ConnectPhoneForm-CYfqSIAI-BDD9A_n5.js";import{a as Fe,d as O,w as j,l as p,p as y,m as C,s as Ce,x as Q,c as _,C as ke,T as Ee}from"./PinInput-3SLvbnQa-CalC7LOu.js";import{ErrorScreenView as Se}from"./ErrorScreen-DLsfgpC9-DwaPA2-1.js";import"./QrCode-Bp7vKyXB-Dl74PJZb.js";import"./FingerPrintIcon-BXA1Qwfw.js";import"./Chip-D2-wZOHJ-DUiT6Tro.js";import"./LoadingSkeleton-U6-3yFwI-BqvAdjZO.js";import"./LinkPasskeyScreen-DJveInKu-fpSMIaSF.js";import"./TodoList-CgrU7uwu-C9JMyp_T.js";import"./createLucideIcon-B72mi0g_.js";import"./check-BDT86Nu8.js";import"./ScreenLayout-DIdy7nhJ-CtKEKsly.js";import"./Screen-q8npRQhQ-DadJ2eBF.js";import"./index-Dq_xe9dz-CmgW7sSb.js";import"./circle-check-big-CartQiBB.js";import"./fingerprint-pattern-DCdiYDPD.js";import"./CopyToClipboard-BGTSFnT3-iS0t0RLm.js";import"./copy-Bx2Jwc5_-BzyfXrSH.js";import"./Layouts-BlFm53ED-D8gWrHLU.js";import"./LabelXs-oqZNqbm_-D0IQxw2J.js";import"./Subtitle-CV-2yKE4-D-H5V56C.js";import"./Title-BnzYV3Is-BkAZi-Pa.js";import"./shared-FM0rljBt-CEF3ZWm_.js";import"./reservoir-kvLjIrEo-Do6elMp6.js";import"./lock-C--KDDhh.js";import"./dijkstra-COg3n3zL.js";function be({title:n,titleId:u,...x},c){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:c,"aria-labelledby":u},x),n?o.createElement("title",{id:u},n):null,o.createElement("path",{fillRule:"evenodd",d:"M8.603 3.799A4.49 4.49 0 0 1 12 2.25c1.357 0 2.573.6 3.397 1.549a4.49 4.49 0 0 1 3.498 1.307 4.491 4.491 0 0 1 1.307 3.497A4.49 4.49 0 0 1 21.75 12a4.49 4.49 0 0 1-1.549 3.397 4.491 4.491 0 0 1-1.307 3.497 4.491 4.491 0 0 1-3.497 1.307A4.49 4.49 0 0 1 12 21.75a4.49 4.49 0 0 1-3.397-1.549 4.49 4.49 0 0 1-3.498-1.306 4.491 4.491 0 0 1-1.307-3.498A4.49 4.49 0 0 1 2.25 12c0-1.357.6-2.573 1.549-3.397a4.49 4.49 0 0 1 1.307-3.497 4.49 4.49 0 0 1 3.497-1.307Zm7.007 6.387a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094l3.75-5.25Z",clipRule:"evenodd"}))}const Me=o.forwardRef(be);function Re({title:n,titleId:u,...x},c){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:c,"aria-labelledby":u},x),n?o.createElement("title",{id:u},n):null,o.createElement("path",{fillRule:"evenodd",d:"M4.5 3.75a3 3 0 0 0-3 3v10.5a3 3 0 0 0 3 3h15a3 3 0 0 0 3-3V6.75a3 3 0 0 0-3-3h-15Zm4.125 3a2.25 2.25 0 1 0 0 4.5 2.25 2.25 0 0 0 0-4.5Zm-3.873 8.703a4.126 4.126 0 0 1 7.746 0 .75.75 0 0 1-.351.92 7.47 7.47 0 0 1-3.522.877 7.47 7.47 0 0 1-3.522-.877.75.75 0 0 1-.351-.92ZM15 8.25a.75.75 0 0 0 0 1.5h3.75a.75.75 0 0 0 0-1.5H15ZM14.25 12a.75.75 0 0 1 .75-.75h3.75a.75.75 0 0 1 0 1.5H15a.75.75 0 0 1-.75-.75Zm.75 2.25a.75.75 0 0 0 0 1.5h3.75a.75.75 0 0 0 0-1.5H15Z",clipRule:"evenodd"}))}const Pe=o.forwardRef(Re),Ae=({appName:n,onComplete:u,onReset:x,onClose:c})=>{let[l,T]=o.useState(""),[W,$]=o.useState(!1),[b,k]=o.useState(null),[M,R]=o.useState("enroll"),{initEnrollmentWithSms:r,submitEnrollmentWithSms:U}=X(),{data:t}=V(),w=K();function E(){var m;(m=t==null?void 0:t.mfaEnrollmentFlow)==null||m.onSuccess(),u()}return b?e.jsx(Se,{allowlistConfig:w.allowlistConfig,error:b,onBack:()=>k(null),onRetry:()=>k(null)}):e.jsxs(e.Fragment,M==="enroll"?{children:[e.jsx(h,{backFn:x,onClose:c},"header"),e.jsx(j,{style:{marginBottom:"1.5rem"},children:e.jsx(J,{})}),e.jsx(p,{children:"Set up SMS verification"}),e.jsxs(y,{children:["We'll text a verification code to this mobile device whenever you use your ",n," ","wallet."]}),e.jsxs(O,{children:[e.jsx(we,{onSubmit:async function({qualifiedPhoneNumber:m}){try{await r({phoneNumber:m}),T(m),R("verify")}catch(d){k(d)}},hideRecent:!0}),e.jsxs(ke,{children:["By providing your mobile number, you agree to receive text messages from ",w==null?void 0:w.name,". Some carrier charges may apply"]})]}),e.jsx(f,{})]}:W?{children:[e.jsx(h,{onClose:E},"header"),e.jsx(j,{style:{marginBottom:"1.5rem"},children:e.jsx(ve,{})}),e.jsx(p,{children:"SMS verification added"}),e.jsxs(y,{children:["From now on, you'll enter the verification code sent to your mobile device whenever you use your ",n," wallet."]}),e.jsx(C,{children:e.jsx(F,{onClick:E,children:"Done"})}),e.jsx(f,{})]}:{children:[e.jsx(h,{backFn:function(){M==="verify"?R("enroll"):x()},onClose:c},"header"),e.jsx(j,{style:{marginBottom:"1.5rem"},children:e.jsx(J,{})}),e.jsx(p,{children:"Enter enrollment code"}),e.jsxs(O,{children:[e.jsx(Ee,{onChange:async function(m){try{if(!m)return;await U({phoneNumber:l,mfaCode:m}),$(!0)}catch(d){throw me(d)?Error("You have exceeded the maximum number of attempts. Please close this window and try again in 10 seconds."):de(d)?Error("The code you entered is not valid"):ue(d)?Error("You have exceeded the time limit for code entry. Please try again in 30 seconds."):he(d)?Error("Verification canceled"):Error("Unknown error")}}}),e.jsxs(y,{children:["To continue, enter the 6-digit code sent to ",e.jsx("strong",{children:ge(l)})]})]}),e.jsx(f,{})]})},dn={component:()=>{var z;let{user:n,enrollInMfa:u,ready:x}=ae(),[c,l]=o.useState(null),{unenrollWithSms:T,unenrollWithTotp:W,unenrollWithPasskey:$,submitEnrollmentWithTotp:b,initEnrollmentWithPasskey:k,submitEnrollmentWithPasskey:M,initEnrollmentWithTotp:R}=X(),{data:r,onUserCloseViaDialogOrKeybindRef:U}=V(),t=K(),{closePrivyModal:w}=le(),{promptMfa:E}=ie(),[m,d]=o.useState(!1),[P,A]=o.useState(null),[Z,I]=o.useState(null),a=()=>{w({shouldCallAuthOnSuccess:!0}),u(!1),setTimeout((()=>{l(null),A(null)}),500)},[ee,L]=o.useState(!1),[ne,S]=o.useState();U.current=a;let te=n==null?void 0:n.mfaMethods.includes("sms"),oe=!!(n!=null&&n.phone),re=n==null?void 0:n.mfaMethods.includes("totp"),se=n==null?void 0:n.mfaMethods.includes("passkey"),B=te||re||se,Y=(n==null?void 0:n.linkedAccounts.filter((s=>s.type==="passkey")).map((s=>s.credentialId)))??[];function v(){l(null),A(null)}async function q(s=Y){var i,g;L(!0);try{return await k(),await M({credentialIds:s},{removeForLogin:(i=r==null?void 0:r.mfaEnrollmentFlow)==null?void 0:i.shouldUnlinkOnUnenrollMfa}),(g=r==null?void 0:r.mfaEnrollmentFlow)==null||g.onSuccess(),a()}catch(N){S(N)}finally{L(!1)}}if(o.useEffect((()=>{B&&d(!0)}),[B]),!x||!n||!t)return e.jsxs(e.Fragment,{children:[e.jsx(h,{onClose:a},"header"),e.jsx(Fe,{children:e.jsx(xe,{})}),e.jsx(O,{children:e.jsx(ce,{})}),e.jsx(f,{})]});if(c==="sms")return e.jsxs(e.Fragment,{children:[e.jsx(h,{backFn:v,onClose:a},"header"),e.jsx(j,{style:{marginBottom:"1.5rem"},children:e.jsx(H,{})}),e.jsx(p,{children:"Remove SMS verification?"}),e.jsxs(y,{children:["MFA adds an extra layer of security to your ",t==null?void 0:t.name," account. Make sure you have other methods to secure your account."]}),e.jsx(C,{children:e.jsx(F,{$warn:!0,onClick:async function(){l(null);try{await T()}catch{l(null)}},children:"Remove"})}),e.jsx(f,{})]});if(c==="totp")return e.jsxs(e.Fragment,{children:[e.jsx(h,{backFn:v,onClose:a},"header"),e.jsx(j,{style:{marginBottom:"1.5rem"},children:e.jsx(H,{})}),e.jsx(p,{children:"Remove authenticator app verification?"}),e.jsxs(y,{children:["MFA adds an extra layer of security to your ",t==null?void 0:t.name," account. Make sure you have other methods to secure your account."]}),e.jsx(C,{children:e.jsx(F,{$warn:!0,onClick:async function(){l(null);try{await W()}catch{l(null)}},children:"Remove"})}),e.jsx(f,{})]});if(c==="passkey"){let s=((z=r==null?void 0:r.mfaEnrollmentFlow)==null?void 0:z.shouldUnlinkOnUnenrollMfa)??!0;return e.jsxs(e.Fragment,{children:[e.jsx(h,{backFn:v,onClose:a},"header"),e.jsx(j,{style:{marginBottom:"1.5rem"},children:e.jsx(H,{})}),e.jsx(p,{children:"Are you sure you want to remove this passkey?"}),e.jsx(y,{children:s?"Removing your passkey will remove as both a verification method and a login method.":"Removing your passkey will remove as a verification method."}),e.jsx(C,{children:e.jsx(F,{$warn:!0,onClick:async function(){var i;l(null);try{await $({removeForLogin:(i=r==null?void 0:r.mfaEnrollmentFlow)==null?void 0:i.shouldUnlinkOnUnenrollMfa})}catch{l(null)}},children:"Remove"})}),e.jsx(f,{})]})}if(r.mfaEnrollmentFlow.mfaMethods.length===0&&!B)return e.jsxs(e.Fragment,{children:[e.jsx(h,{onClose:a},"header"),e.jsx(j,{style:{marginBottom:"1.5rem"},children:e.jsx(D,{})}),e.jsx(p,{children:"Add more security"}),e.jsxs(y,{children:[t==null?void 0:t.name," does not have any verification methods enabled."]}),e.jsx(C,{children:e.jsx(F,{onClick:a,children:"Close"})}),e.jsx(f,{})]});let G=!B&&!m;return G?e.jsxs(e.Fragment,{children:[e.jsx(h,{onClose:a},"header"),e.jsx(j,{style:{marginBottom:"1.5rem"},children:e.jsx(D,{})}),e.jsx(p,{children:"Transaction Protection"}),e.jsx(y,{children:"Set up transaction protection to add an extra layer of security to your account"}),e.jsxs(Ce,{children:[e.jsxs(Q,{children:[e.jsx(_,{children:e.jsx(Me,{})}),"Enable 2-Step verification for your ",t==null?void 0:t.name," wallet."]}),e.jsxs(Q,{children:[e.jsx(_,{children:e.jsx(Pe,{})}),"You'll be prompted to authenticate to complete transactions."]})]}),e.jsxs(C,{children:[e.jsx(F,{onClick:()=>d(!0),children:"Continue"}),e.jsx(fe,{onClick:a,children:"Not now"})]}),e.jsx(f,{})]}):P==="sms"?e.jsx(Ae,{appName:(t==null?void 0:t.name)||"Privy",onComplete:a,onReset:v,onClose:a}):P==="totp"&&Z?e.jsx(je,{onClose:a,onReset:v,submitEnrollmentWithTotp:({mfaCode:s})=>(async function(i){var g;try{return S(void 0),await b({mfaCode:i}),(g=r==null?void 0:r.mfaEnrollmentFlow)==null||g.onSuccess(),a()}catch(N){S(N)}finally{l(null)}})(s),totpInfo:{...Z,appName:(t==null?void 0:t.name)||"Privy"}}):P==="passkey"?e.jsx(pe,{onReset:v,onClose:a,submitEnrollmentWithPasskey:q}):e.jsx(ye,{showIntro:G,userMfaMethods:n.mfaMethods,appMfaMethods:t.mfa.methods,userHasAuthSms:oe,backFn:function(){d(!1)},handleSelectMethod:async function(s){try{await E()}catch(i){return void S(i)}return s==="totp"?(A(s),I(null),void R().then((i=>{I(i)})).catch((()=>{I(null),v()}))):s==="passkey"&&Y.length===1?await q():void A(s)},isTotpLoading:P==="totp"&&!Z,isPasskeyLoading:ee,error:ne,onClose:a,setRemovingMfaMethod:async s=>{try{await E()}catch(i){return void S(i)}l(s)}})}};export{dn as MfaEnrollmentFlowScreen,dn as default};
