import{d7 as H,d9 as b,dl as at,fd as st,dc as it,fo as we,d6 as ze,d5 as ye,ek as Fe,df as D,db as $,fp as _e,dZ as Me,fq as rt,fr as ot,fa as lt,fs as ct,ft as dt,fu as He,fv as Je,fw as ut,fx as Te,e7 as gt,fy as ft,fe as je,fz as pt,fA as ht,fB as mt,fC as wt,fD as Pe,fE as yt,fF as vt,dn as De,d4 as m,fb as $e,fG as Le,fH as At,fI as Ne,di as St,ff as Be,fJ as Ie,fg as Re,fK as ke,fL as Tt}from"./index-BZUZJG0z.js";import{F as It}from"./CheckCircleIcon-D6_brTOf.js";import{b as be,m as bt}from"./ModalHeader-D5psNgrf-BlEKM6aB.js";import{c as Et,n as Ot,s as Ct,t as Wt}from"./Layouts-BlFm53ED-D8gWrHLU.js";import{o as Ve}from"./ScreenHeader-CHmc4-Lu-D968ig42.js";import{t as Ee}from"./FundWalletMethodHeader-CI5afzwL-BZtXSULE.js";import{i as jt}from"./InjectedWalletIcon-DLcYOGDj-DBB2QKeI.js";import{t as xt}from"./index-Dq_xe9dz-CmgW7sSb.js";import{t as Ft,s as _t,e as Mt,n as Ut}from"./Value-tcJV9e0L-Dbu4EDrR.js";import{d as Ze,f as me,c as Pt,u as Dt,p as $t,l as he}from"./useSolanaRpcClient-C55AFEgY-BA5gsE4U.js";import{c as Lt}from"./useGetTokenPrice-C1-pGMgN-DqVN8PHa.js";import{t as Nt}from"./analytics-mkkvFRju-DOXuftJB.js";import{C as pe,e as Ge,s as Bt}from"./getFormattedUsdFromLamports-B6EqSEho-C-HCdwKa.js";import{r as Rt}from"./getUsdcMintAddress-DFI1hv05-jlhpBW9a.js";import{e as kt}from"./getChainName-DjpPdUSc-c2urPd0g.js";import{n as Oe}from"./formatters-BCBPo00w.js";import"./WalletIcon-hh3-YJ30.js";import"./LoadingSkeleton-U6-3yFwI-BqvAdjZO.js";import"./useGetSolPrice-Cfm8o9C5-DeeG65FR.js";const qe=()=>{let{walletProxy:e,client:n}=H();return b.useMemo((()=>({signWithUserSigner:async({message:r,targetAppId:l})=>{if(!e)throw Error("Wallet proxy not initialized");let u=await n.getAccessToken();if(!u)throw Error("User must be authenticated");let{signature:c}=await e.signWithUserSigner({accessToken:u,message:r,targetAppId:l});return{signature:c}}})),[e,n])},Xe=["solana:mainnet","solana:devnet","solana:testnet"];function Vt(e){return st().decode(e)}function Z(e,n){if(!Object.prototype.hasOwnProperty.call(e,n))throw TypeError("attempted to use private field on non-instance");return e}var Gt=0,L="__private_"+Gt+++"__implementation";function P(e,n){if(!Object.prototype.hasOwnProperty.call(e,n))throw TypeError("attempted to use private field on non-instance");return e}var Kt=0;function J(e){return"__private_"+Kt+++"_"+e}var q=J("_address"),X=J("_publicKey"),ee=J("_chains"),te=J("_features"),ne=J("_label"),ae=J("_icon");class Ue{get address(){return P(this,q)[q]}get publicKey(){return P(this,X)[X].slice()}get chains(){return P(this,ee)[ee].slice()}get features(){return P(this,te)[te].slice()}get label(){return P(this,ne)[ne]}get icon(){return P(this,ae)[ae]}constructor({address:n,publicKey:r,label:l,icon:u}){Object.defineProperty(this,q,{writable:!0,value:void 0}),Object.defineProperty(this,X,{writable:!0,value:void 0}),Object.defineProperty(this,ee,{writable:!0,value:void 0}),Object.defineProperty(this,te,{writable:!0,value:void 0}),Object.defineProperty(this,ne,{writable:!0,value:void 0}),Object.defineProperty(this,ae,{writable:!0,value:void 0}),P(this,q)[q]=n,P(this,X)[X]=r,P(this,ee)[ee]=Xe,P(this,ne)[ne]=l,P(this,ae)[ae]=u,P(this,te)[te]=["solana:signAndSendTransaction","solana:signTransaction","solana:signMessage"],new.target===Ue&&Object.freeze(this)}}function o(e,n){if(!Object.prototype.hasOwnProperty.call(e,n))throw TypeError("attempted to use private field on non-instance");return e}var Qt=0;function O(e){return"__private_"+Qt+++"_"+e}var _=O("_listeners"),se=O("_version"),ie=O("_name"),re=O("_icon"),W=O("_injection"),oe=O("_isPrivyWallet"),K=O("_accounts"),le=O("_on"),Q=O("_emit"),Ce=O("_off"),Y=O("_connected"),ce=O("_connect"),de=O("_disconnect"),ue=O("_signMessage"),ge=O("_signAndSendTransaction"),fe=O("_signTransaction");function Yt(e,...n){var r;(r=o(this,_)[_][e])==null||r.forEach((l=>l.apply(null,n)))}function zt(e,n){var r;o(this,_)[_][e]=(r=o(this,_)[_][e])==null?void 0:r.filter((l=>n!==l))}function Ht(e,n,r){let l=structuredClone(gt().decode(e)),u=ft(n);return u in l.signatures&&(l.signatures[u]=r),new Uint8Array(je().encode(l))}function et(){let{isHeadlessSigning:e,walletProxy:n,initializeWalletProxy:r,recoverEmbeddedWallet:l,openModal:u,privy:c,client:a}=H(),{user:t}=we(),{setModalData:d}=ye(),{signWithUserSigner:g}=qe();return{signMessage:({message:i,address:f,options:S})=>new Promise((async(E,x)=>{var v;let p=Fe(t,f);if((p==null?void 0:p.walletClientType)!=="privy")return void x(new D("Wallet is not a Privy wallet",void 0,$.EMBEDDED_WALLET_NOT_FOUND));let{entropyId:T,entropyIdVerifier:I}=Me(t,p),h=_e(p),y=me(i).toString("base64");if(y.length<1)return void x(new D("Message must be a non-empty string",void 0,$.INVALID_MESSAGE));let M=async()=>{var s;let A;if(!t)throw Error("User must be authenticated before signing with a Privy wallet");let C=await a.getAccessToken();if(!C)throw Error("User must be authenticated to use their embedded wallet.");let R=n??await r(15e3);if(!R)throw Error("Failed to initialize embedded wallet proxy.");if(!await l({address:p.address}))throw Error("Unable to connect to wallet");if(h){let w=await He(c,g,{chain_type:"solana",method:"signMessage",params:{message:y,encoding:"base64"},wallet_id:p.id});if(!w.data||!("signature"in w.data))throw Error("Failed to sign message");A=w.data.signature}else{let{response:w}=await R.rpc({accessToken:C,entropyId:T,entropyIdVerifier:I,chainType:"solana",hdWalletIndex:p.walletIndex??0,requesterAppId:(s=S==null?void 0:S.uiOptions)==null?void 0:s.requesterAppId,request:{method:"signMessage",params:{message:y}}});A=w.data.signature}return A};if(e({showWalletUIs:(v=S==null?void 0:S.uiOptions)==null?void 0:v.showWalletUIs}))try{let A=await M(),C=new Uint8Array(me(A,"base64"));E({signature:C})}catch(A){x(A)}else d({signMessage:{method:"solana_signMessage",data:y,confirmAndSign:M,onSuccess:A=>{E({signature:new Uint8Array(me(A,"base64"))})},onFailure:A=>{x(A)},uiOptions:(S==null?void 0:S.uiOptions)??{}},connectWallet:{recoveryMethod:p.recoveryMethod,connectingWalletAddress:p.address,entropyId:T,entropyIdVerifier:I,isUnifiedWallet:h,onCompleteNavigateTo:"SignRequestScreen",onFailure:A=>{x(new D("Failed to connect to wallet",A,$.UNKNOWN_CONNECT_WALLET_ERROR))}}}),u("EmbeddedWalletConnectingScreen")}))}}function Ke(){let{isHeadlessSigning:e,openModal:n}=H(),{setModalData:r}=ye(),{signMessage:l}=et(),{user:u}=we();return{signTransaction:async({transaction:c,options:a,chain:t="solana:mainnet",address:d})=>{var i;async function g(f){let{signature:S}=await l({message:Pt(f),address:d,options:{...a,uiOptions:{...a==null?void 0:a.uiOptions,showWalletUIs:!1}}});return{signedTransaction:Ht(f,d,S)}}return e({showWalletUIs:(i=a==null?void 0:a.uiOptions)==null?void 0:i.showWalletUIs})?g(c):new Promise((async(f,S)=>{let E=Fe(u,d);if((E==null?void 0:E.walletClientType)!=="privy")return void S(new D("Wallet is not a Privy wallet",void 0,$.EMBEDDED_WALLET_NOT_FOUND));let{entropyId:x,entropyIdVerifier:p}=Me(u,E),T=_e(E);function I(y){return M=>{S(M instanceof D?M:new D("Failed to connect to wallet",M,y))}}let h={account:E,transaction:c,chain:t,signOnly:!0,uiOptions:(a==null?void 0:a.uiOptions)||{},onConfirm:g,onSuccess:f,onFailure:I($.TRANSACTION_FAILURE)};r({connectWallet:{recoveryMethod:E.recoveryMethod,connectingWalletAddress:E.address,entropyId:x,entropyIdVerifier:p,isUnifiedWallet:T,onCompleteNavigateTo:"StandardSignAndSendTransactionScreen",onFailure:I($.UNKNOWN_CONNECT_WALLET_ERROR)},standardSignAndSendTransaction:h}),n("EmbeddedWalletConnectingScreen")}))}}}let z=new class extends ut{setImplementation(e){Z(this,L)[L]=e}async signMessage(e){return Z(this,L)[L].signMessage(e)}async signAndSendTransaction(e){return Z(this,L)[L].signAndSendTransaction(e)}async signTransaction(e){return Z(this,L)[L].signTransaction(e)}constructor(e){super(),Object.defineProperty(this,L,{writable:!0,value:void 0}),Z(this,L)[L]=e}}({signTransaction:Te("signTransaction was not injected"),signAndSendTransaction:Te("signAndSendTransaction was not injected"),signMessage:Te("signMessage was not injected")}),Qe=new class{get version(){return o(this,se)[se]}get name(){return o(this,ie)[ie]}get icon(){return o(this,re)[re]}get chains(){return Xe.slice()}get features(){return{"standard:connect":{version:"1.0.0",connect:o(this,ce)[ce]},"standard:disconnect":{version:"1.0.0",disconnect:o(this,de)[de]},"standard:events":{version:"1.0.0",on:o(this,le)[le]},"solana:signAndSendTransaction":{version:"1.0.0",supportedTransactionVersions:["legacy",0],signAndSendTransaction:o(this,ge)[ge]},"solana:signTransaction":{version:"1.0.0",supportedTransactionVersions:["legacy",0],signTransaction:o(this,fe)[fe]},"solana:signMessage":{version:"1.0.0",signMessage:o(this,ue)[ue]},"privy:":{privy:{signMessage:o(this,W)[W].signMessage,signTransaction:o(this,W)[W].signTransaction,signAndSendTransaction:o(this,W)[W].signAndSendTransaction}}}}get accounts(){return o(this,K)[K].slice()}get isPrivyWallet(){return o(this,oe)[oe]}constructor({name:e,icon:n,version:r,injection:l,wallets:u}){Object.defineProperty(this,Q,{value:Yt}),Object.defineProperty(this,Ce,{value:zt}),Object.defineProperty(this,_,{writable:!0,value:void 0}),Object.defineProperty(this,se,{writable:!0,value:void 0}),Object.defineProperty(this,ie,{writable:!0,value:void 0}),Object.defineProperty(this,re,{writable:!0,value:void 0}),Object.defineProperty(this,W,{writable:!0,value:void 0}),Object.defineProperty(this,oe,{writable:!0,value:void 0}),Object.defineProperty(this,K,{writable:!0,value:void 0}),Object.defineProperty(this,le,{writable:!0,value:void 0}),Object.defineProperty(this,Y,{writable:!0,value:void 0}),Object.defineProperty(this,ce,{writable:!0,value:void 0}),Object.defineProperty(this,de,{writable:!0,value:void 0}),Object.defineProperty(this,ue,{writable:!0,value:void 0}),Object.defineProperty(this,ge,{writable:!0,value:void 0}),Object.defineProperty(this,fe,{writable:!0,value:void 0}),o(this,_)[_]={},o(this,le)[le]=(c,a)=>{var t;return(t=o(this,_)[_][c])!=null&&t.push(a)||(o(this,_)[_][c]=[a]),()=>o(this,Ce)[Ce](c,a)},o(this,Y)[Y]=c=>{c!=null&&(o(this,K)[K]=c.map((({address:a})=>new Ue({address:a,publicKey:Je.decode(a)})))),o(this,Q)[Q]("change",{accounts:this.accounts})},o(this,ce)[ce]=async()=>(o(this,Q)[Q]("change",{accounts:this.accounts}),{accounts:this.accounts}),o(this,de)[de]=async()=>{o(this,Q)[Q]("change",{accounts:this.accounts})},o(this,ue)[ue]=async(...c)=>{let a=[];for(let{account:t,...d}of c){let{signature:g}=await o(this,W)[W].signMessage({...d,address:t.address});a.push({signedMessage:d.message,signature:g})}return a},o(this,ge)[ge]=async(...c)=>{let a=[];for(let t of c){let{signature:d}=await o(this,W)[W].signAndSendTransaction({...t,transaction:t.transaction,address:t.account.address,chain:t.chain||"solana:mainnet",options:t.options});a.push({signature:d})}return a},o(this,fe)[fe]=async(...c)=>{let a=[];for(let{transaction:t,account:d,options:g,chain:i}of c){let{signedTransaction:f}=await o(this,W)[W].signTransaction({transaction:t,address:d.address,chain:i||"solana:mainnet",options:g});a.push({signedTransaction:f})}return a},o(this,ie)[ie]=e,o(this,re)[re]=n,o(this,se)[se]=r,o(this,W)[W]=l,o(this,K)[K]=[],o(this,oe)[oe]=!0,l.on("accountChanged",o(this,Y)[Y],this),o(this,Y)[Y](u)}}({name:"Privy",version:"1.0.0",icon:"data:image/png;base64,AAABAAEAFBQAAAAAIABlAQAAFgAAAIlQTkcNChoKAAAADUlIRFIAAAAUAAAAFAgGAAAAjYkdDQAAAAlwSFlzAAAOwwAADsMBx2+oZAAAAQVJREFUeJxiYMANZIC4E4ivAPFPIP4FxDeAuB+IlfDowwBMQFwJxF+B+D8O/AOI66Bq8QJGIF6ExyB0vAqImfEZmEeCYTDcgMswPiB+T4aB34FYApuBsWQYBsP52AycToGBK7EZuJECAw9jM3AVBQbuwWZgIwUGTsZmoDkFBnpiMxAEjpJh2FV8iVsbiD+TYBgoDVrgMgwGnID4HRGGgTKBGyHDYEAaiBdCSxh0g/5AU4Q8sYYhAzEgjoGmABBOgFo2eACowFABYn0oVgViAVINkQTiZUD8DIj/ATF6GILEXgLxCiCWIsZAbiAuBeKtQHwHiEHJ6C8UfwHie0C8E4jLoWpRAAAAAP//rcbhsQAAAAZJREFUAwBYFs3VKJ0cuQAAAABJRU5ErkJggg==",wallets:[],injection:z});function Jt(){let{ready:e}=it(),{user:n}=we(),{signMessage:r}=et(),{signTransaction:l}=Ke(),{signAndSendTransaction:u}=(function(){let t=ze(),{isHeadlessSigning:d,openModal:g}=H(),{setModalData:i}=ye(),{signTransaction:f}=Ke(),S=Ze(),{user:E}=we(),{signWithUserSigner:x}=qe();return{signAndSendTransaction:async({transaction:p,address:T,chain:I="solana:mainnet",options:h})=>{var A;let y=Fe(E,T);if((y==null?void 0:y.walletClientType)!=="privy")throw new D("Wallet is not a Privy wallet",void 0,$.EMBEDDED_WALLET_NOT_FOUND);let M=_e(y);async function v(C){if(h!=null&&h.sponsor)return await(async w=>{if(!M)throw new D("Sponsoring transactions is only supported for wallets on the TEE stack",$.INVALID_DATA);let U=new ct({appId:t.id,clientId:t.appClientId,storage:dt}),F=await He(U,x,{chain_type:"solana",method:"signAndSendTransaction",sponsor:!0,params:{transaction:me(w).toString("base64"),encoding:"base64"},caip2:`solana:${(await S(I).rpc.getGenesisHash().send()).substring(0,32)}`,wallet_id:y.id});if(F.data&&"hash"in F.data)return{signature:Je.decode(F.data.hash)};throw Error("Failed to sign and send transaction")})(C);let{signedTransaction:R}=await f({transaction:C,address:T,chain:I,options:{...h,uiOptions:{...h==null?void 0:h.uiOptions,showWalletUIs:!1}}}),{signature:s}=await S(I).sendAndConfirmTransaction(R);return{signature:s}}return d({showWalletUIs:(A=h==null?void 0:h.uiOptions)==null?void 0:A.showWalletUIs})?v(p):new Promise((async(C,R)=>{let s,w,{entropyId:U,entropyIdVerifier:F}=Me(E,y);function k(G){return j=>{R(j instanceof D?j:new D("Failed to connect to wallet",j,G))}}let N={account:y,transaction:p,chain:I,signOnly:!1,uiOptions:(h==null?void 0:h.uiOptions)||{},onConfirm:v,onSuccess:C,onFailure:k($.TRANSACTION_FAILURE),isSponsored:!!(h!=null&&h.sponsor)},V={recoveryMethod:y.recoveryMethod,connectingWalletAddress:y.address,entropyId:U,entropyIdVerifier:F,isUnifiedWallet:M,onCompleteNavigateTo:"StandardSignAndSendTransactionScreen",onFailure:k($.UNKNOWN_CONNECT_WALLET_ERROR)};t.fundingConfig&&(s=rt({address:T,appConfig:t,methodScreen:"FundingMethodSelectionScreen",fundWalletConfig:{...h,asset:"native-currency",chain:I},externalSolanaFundingScreen:"FundSolWalletWithExternalSolanaWallet"}),w={amount:t.fundingConfig.defaultRecommendedAmount,asset:"SOL",chain:I,destinationAddress:T,afterSuccessScreen:"StandardSignAndSendTransactionScreen",sourceWalletData:void 0}),i({connectWallet:V,standardSignAndSendTransaction:N,funding:s,solanaFundingData:w}),g("EmbeddedWalletConnectingScreen")}))}}})(),c=b.useMemo((()=>{let t=[...ot(n).sort(((g,i)=>(g.walletIndex??0)-(i.walletIndex??0)))],d=lt(n);return d.length?[...t,...d]:t}),[n]),a=b.useMemo((()=>({signMessage:async({message:t,address:d,options:g})=>await r({message:t,address:d,options:g}),signTransaction:async({transaction:t,address:d,chain:g,options:i})=>await l({transaction:t,address:d,chain:g,options:i}),async signAndSendTransaction({transaction:t,address:d,chain:g,options:i}){let{signature:f}=await u({transaction:t,address:d,chain:g,options:i});return{signature:f}}})),[r,l,u]);return b.useEffect((()=>{z==null||z.setImplementation(a)}),[a]),b.useEffect((()=>{var t;!e||(t=Qe.accounts).length===c.length&&t.every(((d,g)=>{var i;return d.address===((i=c[g])==null?void 0:i.address)}))||(z==null||z.emit("accountChanged",c))}),[e,c]),{ready:e,wallet:Qe}}function Zt(){let{client:e}=H(),{ready:n,wallet:r}=Jt(),[l,u]=b.useState([]),[c,a]=b.useState([]);return b.useEffect((()=>{let t=[r,...l.filter((i=>i.chainType==="solana"&&!!i.wallet.features)).map((i=>i.wallet))];a(t);let d=l.flatMap((i=>{let f=()=>a([...t]);return i.on("walletsUpdated",f),{connector:i,off:f}})),g=t.map((i=>{var f;return(f=i.features["standard:events"])==null?void 0:f.on("change",(()=>{a([...t])}))}));return()=>{g.forEach((i=>i==null?void 0:i())),d.forEach((({connector:i,off:f})=>i.off("walletsUpdated",f)))}}),[l]),b.useEffect((()=>{var d,g;u(((d=e.connectors)==null?void 0:d.walletConnectors.filter((i=>i.chainType==="solana")))??[]);let t=()=>{var i;u(((i=e.connectors)==null?void 0:i.walletConnectors.filter((f=>f.chainType==="solana")))??[])};return(g=e.connectors)==null||g.on("connectorInitialized",t),()=>{var i;(i=e.connectors)==null||i.off("connectorInitialized",t)}}),[n,e.connectors]),{ready:n,wallets:c}}function qt(){let{ready:e,wallets:n}=Zt();return{ready:e,wallets:b.useMemo((()=>n.flatMap((r=>r.accounts.map((l=>new at({wallet:r,account:l})))))),[n])}}var Xt="11111111111111111111111111111111";function en(e){if(!e)throw new Error("Expected a Address.");return typeof e=="object"&&"address"in e?e.address:Array.isArray(e)?e[0]:e}function tn(e,n){return r=>{if(!r.value)return;const l=r.isWritable?Pe.WRITABLE:Pe.READONLY;return Object.freeze({address:en(r.value),role:Ye(r.value)?yt(l):l,...Ye(r.value)?{signer:r.value}:{}})}}function Ye(e){return!!e&&typeof e=="object"&&"address"in e&&vt(e)}var nn=2;function an(){return pt(ht([["discriminator",mt()],["amount",wt()]]),e=>({...e,discriminator:nn}))}function sn(e,n){const r=Xt,u={source:{value:e.source??null,isWritable:!0},destination:{value:e.destination??null,isWritable:!0}},c={...e},a=tn();return Object.freeze({accounts:[a(u.source),a(u.destination)],data:an().encode(c),programAddress:r})}function rn({rows:e}){return m.jsx(Ft,{children:e.filter((n=>!!n)).map(((n,r)=>n.value!=null||n.isLoading?m.jsxs(_t,{children:[m.jsx(Mt,{children:n.label}),m.jsx(Ut,{$isLoading:n.isLoading,children:n.value})]},r):null))})}function xe(e){return BigInt(Math.floor(1e9*parseFloat(e)))}function We(e){return+on.format(parseFloat(e.toString())/1e9)}let on=Intl.NumberFormat(void 0,{maximumFractionDigits:8});async function ln({tx:e,solanaClient:n,amount:r,asset:l,tokenPrice:u}){if(!e)return null;if(l==="SOL"&&u){let c=xe(r),a=pe(c,u),t=await he({solanaClient:n,tx:e});return{amountInUsd:a,feeInUsd:u?pe(t,u):void 0,totalInUsd:pe(c+t,u)}}if(l==="USDC"&&u){let c="$"+r,a=await he({solanaClient:n,tx:e}),t=(function(d,g){let i=parseFloat(d.toString())/Bt*g;return i<.01?0:i})(a,u);return{amountInUsd:c,feeInUsd:pe(a,u),totalInUsd:"$"+(parseFloat(r)+t).toFixed(2)}}if(l==="SOL"){let c=xe(r),a=await he({solanaClient:n,tx:e});return{amountInSol:r+" SOL",feeInSol:We(a)+" SOL",totalInSol:We(c+a)+" SOL"}}return{amountInUsdc:r+" USDC",feeInSol:We(await he({solanaClient:n,tx:e}))+" SOL"}}const Wn={component:function(){let e=ze(),{closePrivyModal:n,createAnalyticsEvent:r}=H(),{data:l,setModalData:u,navigate:c}=ye(),{wallets:a}=qt(),[t,d]=b.useState("preparing"),[g,i]=b.useState(),[f,S]=b.useState(),[E,x]=b.useState();if(!(l!=null&&l.solanaFundingData))throw Error("Funding config is missing");if(!l.solanaFundingData.sourceWalletData)throw Error("Funding config is missing source wallet data");let{amount:p,asset:T,chain:I,sourceWalletData:h,destinationAddress:y,afterSuccessScreen:M}=l.solanaFundingData,v=a.find((s=>s.address===h.address&&De(h.walletClientType)===De(s.standardWallet.name))),A=Ze()(I),{tokenPrice:C,isTokenPriceLoading:R}=Lt("solana");return b.useEffect((()=>{if(t!=="preparing"||R||!v)return;let s=T==="SOL"?xe(p):(function(w){return BigInt(Math.floor(1e6*parseFloat(w)))})(p);S({amount:(T==="SOL"&&C?pe(s,C):p)??p}),(T==="SOL"?(async function({solanaClient:w,source:U,destination:F,amountInLamports:k}){let{value:N}=await w.rpc.getLatestBlockhash().send(),V={address:U},G=$e(Ne({version:0}),(j=>ke(V,j)),(j=>Re(N,j)),(j=>Ie(sn({amount:k,source:V,destination:F}),j)),(j=>Be(j)));return new Uint8Array(je().encode(G))})({solanaClient:A,source:v.address,destination:y,amountInLamports:s}):(async function({solanaClient:w,source:U,destination:F,amountInBaseUnits:k}){let N=Rt(w.chain),{value:V}=await w.rpc.getLatestBlockhash().send(),G={address:U},[j]=await Le({mint:N,owner:U,tokenProgram:Ge}),[ve]=await Le({mint:N,owner:F,tokenProgram:Ge}),[Ae,Se]=await Promise.all([w.rpc.getAccountInfo(j,{commitment:"confirmed",encoding:"jsonParsed"}).send().catch((()=>null)),w.rpc.getAccountInfo(ve,{commitment:"confirmed",encoding:"jsonParsed"}).send().catch((()=>null))]);if(!(Ae!=null&&Ae.value))throw Error(`Source token account does not exist for address: ${U}`);let tt=At({payer:G,ata:ve,owner:F,mint:N}),nt=$e(Ne({version:0}),(B=>ke(G,B)),(B=>Re(V,B)),(B=>Se!=null&&Se.value?B:Ie(tt,B)),(B=>Ie(Tt({source:j,destination:ve,authority:G,amount:k}),B)),(B=>Be(B)));return new Uint8Array(je().encode(nt))})({solanaClient:A,source:v.address,destination:y,amountInBaseUnits:s})).then(i).catch((w=>{d("error"),x(w)}))}),[t,p,T,I,v,y,R,C]),b.useEffect((()=>{t==="preparing"&&g&&ln({tx:g,solanaClient:A,amount:p,asset:T,tokenPrice:C}).then((s=>{d("loaded"),S({amount:(s==null?void 0:s.amountInUsd)??(s==null?void 0:s.amountInUsdc)??(s==null?void 0:s.amountInSol)??p,fee:(s==null?void 0:s.feeInUsd)??(s==null?void 0:s.feeInSol),total:(s==null?void 0:s.totalInUsd)??(s==null?void 0:s.totalInSol)})})).catch((s=>{d("error"),x(s)}))}),[g,p,T,t,C]),b.useEffect((()=>{t==="error"&&E&&(u({errorModalData:{error:E,previousScreen:"FundSolWalletWithExternalSolanaWallet"},solanaFundingData:l.solanaFundingData}),c("ErrorScreen",!1))}),[t,c]),b.useEffect((()=>{if(t!=="success")return;let s=setTimeout(M?()=>c(M):n,St);return()=>clearTimeout(s)}),[t]),m.jsxs(m.Fragment,t==="success"?{children:[m.jsx(Ee,{}),m.jsx(Et,{}),m.jsxs(Ot,{children:[m.jsx(It,{color:"var(--privy-color-success)",width:"64px",height:"64px"}),m.jsx(Ve,{title:"Success!",description:`Youâ€™ve successfully added ${p} ${T} to your ${e.name} wallet. It may take a minute before the funds are available to use.`})]}),m.jsx(Ct,{}),m.jsx(be,{})]}:t==="preparing"||t==="loaded"||t==="sending"?{children:[m.jsx(Ee,{}),m.jsx(Wt,{style:{marginTop:"16px"},children:m.jsx(jt,{icon:v==null?void 0:v.standardWallet.icon,name:v==null?void 0:v.standardWallet.name})}),m.jsx(Ve,{style:{marginTop:"8px",marginBottom:"12px"},title:t==="sending"&&v?`Confirming with ${v.standardWallet.name}`:"Confirm transaction"}),m.jsx(rn,{rows:[{label:"Source",value:Oe(h.address)},{label:"Destination",value:Oe(y)},{label:"Network",value:kt(I)},{label:"Amount",value:f==null?void 0:f.amount,isLoading:t==="preparing"},{label:"Estimated fee",value:f==null?void 0:f.fee,isLoading:t==="preparing"},{label:"Total",value:f==null?void 0:f.total,isLoading:t==="preparing"}]}),m.jsx(bt,{style:{marginTop:"1rem"},loading:t==="preparing"||t==="sending",onClick:function(){t==="loaded"&&g&&v&&(d("sending"),(async function({transaction:s,chain:w,sourceWallet:U,solanaClient:F}){let{hasFunds:k}=await Dt({solanaClient:F,tx:s});if(!k)throw new D(`Wallet ${Oe(U.address)} does not have enough funds.`,void 0,$.INSUFFICIENT_BALANCE);let N=Vt((await U.signAndSendTransaction({transaction:s,chain:w}).catch((V=>{throw new D("Transaction was rejected by the user",V,$.TRANSACTION_FAILURE)}))).signature);return await $t({rpcSubscriptions:F.rpcSubscriptions,signature:N,timeout:2e4}),N})({solanaClient:A,transaction:g,chain:I,sourceWallet:v}).then((s=>{d("success"),r({eventName:Nt,payload:{provider:"external",status:"success",txHash:s,address:v.address,value:p,chainType:"solana",clusterName:I,token:T,destinationAddress:y,destinationValue:p,destinationChainType:"solana",destinationClusterName:I,destinationToken:T}})})).catch((s=>{d("error"),x(s)})))},children:"Confirm"}),m.jsx(be,{})]}:{children:[m.jsx(Ee,{}),m.jsx(xt,{}),m.jsx("div",{style:{marginTop:"1rem"}}),m.jsx(be,{})]})}};export{Wn as FundSolWalletWithExternalSolanaWallet,Wn as default};
