import{d6 as P,d5 as D,d7 as F,dK as K,d9 as p,df as g,d4 as _,dL as L,dw as S,dM as V,db as B}from"./index-BZUZJG0z.js";import{a as Q}from"./shouldProceedtoEmbeddedWalletCreationFlow-D0uaMzCB-ChwW2HLS.js";import{n as q}from"./ScreenLayout-DIdy7nhJ-CtKEKsly.js";import"./ModalHeader-D5psNgrf-BlEKM6aB.js";import"./Screen-q8npRQhQ-DadJ2eBF.js";import"./index-Dq_xe9dz-CmgW7sSb.js";const Y=({providerApp:a,success:s,error:r,onClose:i})=>{let{title:m,subtitle:f}=p.useMemo((()=>s?{title:`Successfully connected with ${a.name}`,subtitle:"You're good to go!"}:r?{title:"Authentication failed",subtitle:r.message}:{title:`Connecting to ${a.name}`,subtitle:`Please check the pop-up from ${a.name} to continue`}),[s,r,a.name]);return _.jsx(q,{title:m,subtitle:f,icon:a.logoUrl,iconVariant:"loading",iconLoadingStatus:{success:s,fail:!!r},onBack:i,watermark:!0})},T={component:()=>{let a=P(),{data:s,navigate:r,setModalData:i,onUserCloseViaDialogOrKeybindRef:m}=D(),{crossAppAuthFlow:f,updateWallets:k,closePrivyModal:C,createAnalyticsEvent:M}=F(),{logout:j}=K(),[o,c]=p.useState({}),e=s==null?void 0:s.crossAppAuth,A=new g(`There was an issue connecting your ${e==null?void 0:e.name} account. Please try again.`),N=new L((async n=>{var u,l,d,b,y,w,v,I,U,E,$,x,O,R,W;if(e!=null&&e.popup)try{let t=await f({appId:n,popup:e.popup,action:e.action,disableSignup:e.disableSignup});c({data:t})}catch(t){if(t instanceof g)c({error:t});else if(t instanceof V){if(t.privyErrorCode===B.ACCOUNT_TRANSFER_REQUIRED&&((l=(u=t.data)==null?void 0:u.data)!=null&&l.nonce))return i({accountTransfer:{nonce:(b=(d=t.data)==null?void 0:d.data)==null?void 0:b.nonce,account:(w=(y=t.data)==null?void 0:y.data)==null?void 0:w.subject,displayName:(U=(I=(v=t.data)==null?void 0:v.data)==null?void 0:I.account)==null?void 0:U.displayName,linkMethod:`privy:${e.appId}`,embeddedWalletAddress:(x=($=(E=t.data)==null?void 0:E.data)==null?void 0:$.otherUser)==null?void 0:x.embeddedWalletAddress,oAuthUserInfo:(W=(R=(O=t.data)==null?void 0:O.data)==null?void 0:R.otherUser)==null?void 0:W.oAuthUserInfo}}),void r("LinkConflictScreen");e.popup&&e.popup.close(),c({error:A})}else c({error:A})}else c({error:A})})),h=()=>{o.data&&(k(),e==null||e.onSuccess(o.data),C({shouldCallAuthOnSuccess:!0,isSuccess:!0})),e==null||e.onError(o.error??new g("User canceled flow")),C({shouldCallAuthOnSuccess:!1,isSuccess:!1})};return m.current=h,p.useEffect((()=>{var n;(n=e==null?void 0:e.appId)!=null&&n.length&&N.execute(e.appId)}),[e==null?void 0:e.appId]),p.useEffect((()=>{if(!o.data)return;let n=o.data;if(a.legal.requireUsersAcceptTerms&&!n.hasAcceptedTerms){let l=setTimeout((()=>{r("AffirmativeConsentScreen")}),S);return()=>clearTimeout(l)}if(Q(n,a.embeddedWallets)){let l=setTimeout((()=>{i({createWallet:{onSuccess:()=>{},onFailure:d=>{console.error(d),M({eventName:"embedded_wallet_creation_failure_logout",payload:{error:d,provider:`privy:${e==null?void 0:e.appId}`,screen:"CrossAppAuthScreen"}}),j()},callAuthOnSuccessOnClose:!0}}),r("EmbeddedWalletOnAccountCreateScreen")}),S);return()=>clearTimeout(l)}let u=setTimeout(h,S);return()=>clearTimeout(u)}),[o.data]),e!=null&&e.appId?_.jsx(Y,{providerApp:{id:e==null?void 0:e.appId,logoUrl:e==null?void 0:e.logoUrl,name:e==null?void 0:e.name},success:!!o.data,error:o.error,onClose:h}):(console.warn("Missing data for Screen"),null)},isShownBeforeReady:!0};export{T as CrossAppAuthScreen,Y as CrossAppAuthScreenView,T as default};
