import{dA as x,d9 as a,eG as E,d4 as f}from"./index-BZUZJG0z.js";import{Q as b,R as B,U as C,X as S}from"./to-ui-error-l1Vm31qE-CPb64Lxy.js";import"./PinInput-3SLvbnQa-CalC7LOu.js";import"./FingerPrintIcon-BXA1Qwfw.js";import"./PhoneIcon-DO-kIy-O.js";import"./ShieldCheckIcon-B-NJHB3m.js";import"./ModalHeader-D5psNgrf-BlEKM6aB.js";import"./ScreenLayout-DIdy7nhJ-CtKEKsly.js";import"./Screen-q8npRQhQ-DadJ2eBF.js";import"./index-Dq_xe9dz-CmgW7sSb.js";import"./ExclamationTriangleIcon-CLH_TsZy.js";import"./StackedContainer-B2vaEl56-CK5LNgwx.js";import"./useGetTokenPrice-C1-pGMgN-DqVN8PHa.js";import"./useGetSolPrice-Cfm8o9C5-DeeG65FR.js";import"./TransactionDetails-DB8AH1mq-yGptQR4G.js";import"./WalletLink-foFywOfy-BZGpYybr.js";import"./ethers-TpFbevgv-CT39HWSi.js";import"./getFormattedUsdFromLamports-B6EqSEho-C-HCdwKa.js";import"./transaction-CnfuREWo-nROljJQP.js";import"./Layouts-BlFm53ED-D8gWrHLU.js";import"./ChevronDownIcon-k3TGnLFx.js";const P=({onClose:l})=>{let{user:e}=x(),[s,n]=a.useState((e==null?void 0:e.mfaMethods[0])??null),{init:m,cancel:v,submit:p}=E(),[d,h]=a.useState(!1),[M,g]=a.useState(null),[o,i]=a.useState();a.useEffect((()=>{n((e==null?void 0:e.mfaMethods[0])??null)}),[e==null?void 0:e.mfaMethods]);let c=a.useRef(!1);async function y(t){i(void 0);try{if(!t||!s)return;await p(s,t),h(!0),i(void 0),l()}catch(r){throw S(r).error}}async function k(t){if(t!=="passkey")try{n(t),await m(t)}catch(r){console.error(r)}else try{n(t);let r=await m(t);if(!r)throw Error("something went wrong");g(r),await p(t,r),h(!0),i(void 0),l()}catch(r){i(S(r))}}a.useEffect((()=>{!c.current&&s&&(c.current=!0,k(s).finally((()=>{c.current=!1})))}),[]);let u=()=>{n(null),i(void 0),v(),l()};return e?s==="passkey"?f.jsx(b,{account:e.linkedAccounts.filter((t=>t.type==="passkey"&&t.enrolledInMfa)).sort(((t,r)=>r.firstVerifiedAt.valueOf()-t.firstVerifiedAt.valueOf()))[0],submitSuccess:d,hasBlockingError:(o==null?void 0:o.isBlocking)??!1,error:o==null?void 0:o.error,onClose:u,onBack:()=>{n(null),i(void 0)},handleSubmit:()=>y(M).catch(i)}):s?f.jsx(B,{submitSuccess:d,hasBlockingError:(o==null?void 0:o.isBlocking)??!1,handleSubmitCode:y,selectedMethod:s,onClose:u,onBack:e.mfaMethods.length>1?()=>n(null):void 0}):f.jsx(C,{user:e,onSelect:k,handleClose:u}):null};export{P as MfaVerifyFlowScreen,P as default};
