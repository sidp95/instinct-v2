import{P as b,bW as p,bJ as w,a8 as x,bY as d,ck as z,ch as M,fi as k,cj as u,fj as P,a0 as T,fk as E,a7 as N,fl as S,by as B,fm as L,cd as A,fn as _}from"./index-BZUZJG0z.js";function R(s,e){if(s.length!==e.length)throw new b({expectedLength:s.length,givenLength:e.length});const i=[];for(let t=0;t<s.length;t++){const g=s[t],o=e[t];i.push(m(g,o))}return p(i)}function m(s,e,i=!1){if(s==="address"){const n=e;if(!w(n))throw new x({address:n});return d(n.toLowerCase(),{size:i?32:null})}if(s==="string")return z(e);if(s==="bytes")return e;if(s==="bool")return d(M(e),{size:i?32:1});const t=s.match(k);if(t){const[n,r,a="256"]=t,c=Number.parseInt(a,10)/8;return u(e,{size:i?32:c,signed:r==="int"})}const g=s.match(P);if(g){const[n,r]=g;if(Number.parseInt(r,10)!==(e.length-2)/2)throw new T({expectedSize:Number.parseInt(r,10),givenSize:(e.length-2)/2});return d(e,{dir:"right",size:i?32:null})}const o=s.match(E);if(o&&Array.isArray(e)){const[n,r]=o,a=[];for(let c=0;c<e.length;c++)a.push(m(r,e[c],!0));return a.length===0?"0x":p(a)}throw new N(s)}function $(s){const{source:e}=s,i=new Map,t=new S(8192),g=new Map,o=({address:n,chainId:r})=>`${n}.${r}`;return{async consume({address:n,chainId:r,client:a}){const c=o({address:n,chainId:r}),f=this.get({address:n,chainId:r,client:a});this.increment({address:n,chainId:r});const h=await f;return await e.set({address:n,chainId:r},h),t.set(c,h),h},async increment({address:n,chainId:r}){const a=o({address:n,chainId:r}),c=i.get(a)??0;i.set(a,c+1)},async get({address:n,chainId:r,client:a}){const c=o({address:n,chainId:r});let f=g.get(c);return f||(f=(async()=>{try{const l=await e.get({address:n,chainId:r,client:a}),y=t.get(c)??0;return y>0&&l<=y?y+1:(t.delete(c),l)}finally{this.reset({address:n,chainId:r})}})(),g.set(c,f)),(i.get(c)??0)+await f},reset({address:n,chainId:r}){const a=o({address:n,chainId:r});i.delete(a),g.delete(a)}}}function j(s){const{address:e,data:i,signature:t,to:g="hex"}=s,o=p([B([{type:"address"},{type:"bytes"},{type:"bytes"}],[e,i,t]),L]);return g==="hex"?o:A(o)}function C(s){const{r:e,s:i}=_.Signature.fromCompact(s.slice(2,130)),t=+`0x${s.slice(130)}`,[g,o]=(()=>{if(t===0||t===1)return[void 0,t];if(t===27)return[BigInt(t),0];if(t===28)return[BigInt(t),1];throw new Error("Invalid yParityOrV value")})();return typeof g<"u"?{r:u(e,{size:32}),s:u(i,{size:32}),v:g,yParity:o}:{r:u(e,{size:32}),s:u(i,{size:32}),yParity:o}}export{$ as c,R as e,C as p,j as s};
