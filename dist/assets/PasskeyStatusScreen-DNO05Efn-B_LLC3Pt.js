import{d4 as d,d5 as P,d6 as C,d7 as b,dA as T,d9 as a,dw as m,da as _,db as g,ds as O}from"./index-BZUZJG0z.js";import{a as W}from"./shouldProceedtoEmbeddedWalletCreationFlow-D0uaMzCB-ChwW2HLS.js";import{n as x}from"./ScreenLayout-DIdy7nhJ-CtKEKsly.js";import{F}from"./fingerprint-pattern-DCdiYDPD.js";import"./ModalHeader-D5psNgrf-BlEKM6aB.js";import"./Screen-q8npRQhQ-DadJ2eBF.js";import"./index-Dq_xe9dz-CmgW7sSb.js";import"./createLucideIcon-B72mi0g_.js";const j=({status:e,passkeySignupFlow:i=!1,error:t,onRetry:r})=>d.jsx(x,{title:(()=>{switch(e){case"loading":return"Waiting for passkey";case"success":return"Success";case"error":return"Something went wrong"}})(),subtitle:d.jsx(R,{children:(()=>{switch(e){case"loading":return i?"Please follow prompts to register your passkey.":`Please follow prompts to verify your passkey.
You will have to sign up with another method first to register a passkey for your account.`;case"success":return"You've successfully logged in with your passkey.";case"error":if(t instanceof _){if(t.privyErrorCode===g.CANNOT_LINK_MORE_OF_TYPE)return"Cannot link more passkeys to account.";if(t.privyErrorCode===g.PASSKEY_NOT_ALLOWED)return`Passkey request timed out or rejected by user.
You will have to sign up with another method first to register a passkey for your account.`}return`An unknown error occurred.
You will have to sign up with another method first to register a passkey for your account.`}})()}),icon:F,iconVariant:"loading",iconLoadingStatus:{success:e==="success",fail:e==="error"},primaryCta:e==="error"&&r?{label:"Retry",onClick:r}:e==="success"?{label:"Continue",disabled:!0}:void 0,watermark:!0}),V={component:()=>{let{data:e,setModalData:i,navigate:t}=P(),r=C(),{loginWithPasskey:h,signupWithPasskey:w,closePrivyModal:k,createAnalyticsEvent:S}=b(),{user:o,logout:v}=T(),{passkeySignupFlow:p}=(e==null?void 0:e.passkeyAuthModalData)??{},y=m-500,[u,c]=a.useState("loading"),[E,A]=a.useState(null),n=a.useRef([]),l=s=>{n.current=[s,...n.current]};a.useEffect((()=>()=>{n.current.forEach((s=>clearTimeout(s))),n.current=[]}),[]);let f=async()=>{c("loading");try{p?await w():await h(),c("success")}catch(s){A(s),c("error")}};return a.useEffect((()=>{if(u==="success"&&o){if(r!=null&&r.legal.requireUsersAcceptTerms&&!o.hasAcceptedTerms)return void l(setTimeout((()=>{t("AffirmativeConsentScreen")}),y));if(!W(o,r==null?void 0:r.embeddedWallets))return void l(setTimeout((()=>{k({shouldCallAuthOnSuccess:!0,isSuccess:!0})}),m));l(setTimeout((()=>{i({createWallet:{onSuccess:()=>{},onFailure:s=>{console.error(s),S({eventName:"embedded_wallet_creation_failure_logout",payload:{error:s,screen:"PasskeyStatusScreen"}}),v()},callAuthOnSuccessOnClose:!0}}),t("EmbeddedWalletOnAccountCreateScreen")}),y))}}),[o,u]),a.useEffect((()=>{f()}),[]),d.jsx(j,{status:u,passkeySignupFlow:p,error:E,onRetry:f})}};let R=O.span`
  white-space: pre-wrap;
`;export{V as PasskeyStatusScreen,j as PasskeyStatusScreenView,V as default};
